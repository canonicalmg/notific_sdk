!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).NotificAI={})}(this,(function(t){"use strict";function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function n(t,e,n,i,r,a,o){try{var s=t[a](o),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(i,r)}function i(t){return function(){var e=this,i=arguments;return new Promise((function(r,a){var o=t.apply(e,i);function s(t){n(o,r,a,s,c,"next",t)}function c(t){n(o,r,a,s,c,"throw",t)}s(void 0)}))}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,d(i.key),i)}}function o(t,e,n){return e&&a(t.prototype,e),n&&a(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t,n){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,n){if(t){if("string"==typeof t)return e(t,n);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?e(t,n):void 0}}(t))||n&&t&&"number"==typeof t.length){i&&(t=i);var r=0,a=function(){};return{s:a,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){c=!0,o=t},f:function(){try{s||null==i.return||i.return()}finally{if(c)throw o}}}}function c(t,e,n){return(e=d(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function u(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function l(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?u(Object(n),!0).forEach((function(e){c(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function h(){h=function(){return e};var t,e={},n=Object.prototype,i=n.hasOwnProperty,r=Object.defineProperty||function(t,e,n){t[e]=n.value},a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function l(t,e,n,i){var a=e&&e.prototype instanceof y?e:y,o=Object.create(a.prototype),s=new j(i||[]);return r(o,"_invoke",{value:C(t,n,s)}),o}function d(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var f="suspendedStart",p="suspendedYield",g="executing",v="completed",m={};function y(){}function b(){}function w(){}var x={};u(x,o,(function(){return this}));var k=Object.getPrototypeOf,E=k&&k(k(N([])));E&&E!==n&&i.call(E,o)&&(x=E);var A=w.prototype=y.prototype=Object.create(x);function M(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function L(t,e){function n(r,a,o,s){var c=d(t[r],t,a);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==typeof l&&i.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,o,s)}),(function(t){n("throw",t,o,s)})):e.resolve(l).then((function(t){u.value=t,o(u)}),(function(t){return n("throw",t,o,s)}))}s(c.arg)}var a;r(this,"_invoke",{value:function(t,i){function r(){return new e((function(e,r){n(t,i,e,r)}))}return a=a?a.then(r,r):r()}})}function C(e,n,i){var r=f;return function(a,o){if(r===g)throw Error("Generator is already running");if(r===v){if("throw"===a)throw o;return{value:t,done:!0}}for(i.method=a,i.arg=o;;){var s=i.delegate;if(s){var c=S(s,i);if(c){if(c===m)continue;return c}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(r===f)throw r=v,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r=g;var u=d(e,n,i);if("normal"===u.type){if(r=i.done?v:p,u.arg===m)continue;return{value:u.arg,done:i.done}}"throw"===u.type&&(r=v,i.method="throw",i.arg=u.arg)}}}function S(e,n){var i=n.method,r=e.iterator[i];if(r===t)return n.delegate=null,"throw"===i&&e.iterator.return&&(n.method="return",n.arg=t,S(e,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),m;var a=d(r,e.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,m;var o=a.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,m):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function j(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function N(e){if(e||""===e){var n=e[o];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function n(){for(;++r<e.length;)if(i.call(e,r))return n.value=e[r],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}throw new TypeError(typeof e+" is not iterable")}return b.prototype=w,r(A,"constructor",{value:w,configurable:!0}),r(w,"constructor",{value:b,configurable:!0}),b.displayName=u(w,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,u(t,c,"GeneratorFunction")),t.prototype=Object.create(A),t},e.awrap=function(t){return{__await:t}},M(L.prototype),u(L.prototype,s,(function(){return this})),e.AsyncIterator=L,e.async=function(t,n,i,r,a){void 0===a&&(a=Promise);var o=new L(l(t,n,i,r),a);return e.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},M(A),u(A,c,"Generator"),u(A,o,(function(){return this})),u(A,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var i in e)n.push(i);return n.reverse(),function t(){for(;n.length;){var i=n.pop();if(i in e)return t.value=i,t.done=!1,t}return t.done=!0,t}},e.values=N,j.prototype={constructor:j,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(i,r){return s.type="throw",s.arg=e,n.next=i,r&&(n.method="next",n.arg=t),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var c=i.call(o,"catchLoc"),u=i.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=e,a?(this.method="next",this.next=a.finallyLoc,m):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),I(n),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var r=i.arg;I(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(e,n,i){return this.delegate={iterator:N(e),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=t),m}},e}function d(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}var f=function(){return o((function t(){r(this,t),this.observer=null,this.actionMap=this.createEmptyActionMap()}),[{key:"init",value:function(){this.buildActionMap(),this.observeDOM()}},{key:"destroy",value:function(){this.observer&&(this.observer.disconnect(),this.observer=null)}},{key:"getActionMap",value:function(){return this.actionMap.timestamp=Date.now(),this.actionMap}},{key:"createEmptyActionMap",value:function(){return{url:window.location.href,title:document.title,elements:[],timestamp:Date.now()}}},{key:"buildActionMap",value:function(){var t=this;this.actionMap=this.createEmptyActionMap();var e=document.querySelectorAll("[data-ai-field]"),n=document.querySelectorAll("[data-ai-action]");e.forEach((function(e){var n=t.processFieldElement(e);n&&t.actionMap.elements.push(n)})),n.forEach((function(e){var n=t.processActionElement(e);n&&t.actionMap.elements.push(n)}))}},{key:"processFieldElement",value:function(t){var e=t.getAttribute("data-ai-field");if(!e)return null;var n,i,r=t.getBoundingClientRect(),a=t.tagName.toLowerCase();if("input"===a||"textarea"===a)n=t.value;else if("select"===a){var o=t;n=o.value,i=Array.from(o.options).map((function(t){return t.text}))}var s=this.findLabelForElement(t),c=this.getDomPath(t);return{id:this.generateElementId(t),type:"field",name:e,value:n,position:{x:r.left+window.scrollX,y:r.top+window.scrollY},elementType:a,label:s,options:i,required:t.hasAttribute("required"),disabled:t.hasAttribute("disabled"),path:c}}},{key:"processActionElement",value:function(t){var e,n=t.getAttribute("data-ai-action");if(!n)return null;var i=t.getBoundingClientRect(),r=t.tagName.toLowerCase(),a=(null===(e=t.textContent)||void 0===e?void 0:e.trim())||void 0;if(!a||""===a){var o=t.getAttribute("aria-label");o&&(a=o)}var s=this.getDomPath(t);return{id:this.generateElementId(t),type:"action",name:n,position:{x:i.left+window.scrollX,y:i.top+window.scrollY},elementType:r,label:a,disabled:t.hasAttribute("disabled"),path:s}}},{key:"findLabelForElement",value:function(t){if(t.id){var e=document.querySelector('label[for="'.concat(t.id,'"]'));if(e&&e.textContent)return e.textContent.trim()}for(var n=t.parentElement;n;){if("label"===n.tagName.toLowerCase()&&n.textContent)return n.textContent.trim();n=n.parentElement}var i=t.getAttribute("aria-label");if(i)return i;var r=t.getAttribute("placeholder");return r||void 0}},{key:"generateElementId",value:function(t){if(t.id)return t.id;var e=t.getAttribute("data-ai-field")?"field":t.getAttribute("data-ai-action")?"action":"element",n=t.getAttribute("data-ai-field")||t.getAttribute("data-ai-action")||t.tagName.toLowerCase(),i=Math.random().toString(36).substring(2,8);return"notific-".concat(e,"-").concat(n,"-").concat(i)}},{key:"getDomPath",value:function(t){for(var e=[],n=t;n;){var i=n.tagName.toLowerCase();if(n.id)i+="#".concat(n.id);else if(n.className&&"string"==typeof n.className){var r=n.className.split(/\s+/).filter(Boolean);r.length&&(i+=".".concat(r.join(".")))}e.unshift(i),n=n.parentElement}return e}},{key:"observeDOM",value:function(){var t=this;this.observer=new MutationObserver((function(e){var n,i=!1,r=s(e);try{for(r.s();!(n=r.n()).done;){var a=n.value;if("childList"===a.type){for(var o=0,c=Array.from(a.addedNodes);o<c.length;o++){var u=c[o];if(u instanceof HTMLElement&&(u.hasAttribute("data-ai-field")||u.hasAttribute("data-ai-action")||u.querySelector("[data-ai-field], [data-ai-action]"))){i=!0;break}}for(var l=0,h=Array.from(a.removedNodes);l<h.length;l++){var d=h[l];if(d instanceof HTMLElement&&(d.hasAttribute("data-ai-field")||d.hasAttribute("data-ai-action")||d.querySelector("[data-ai-field], [data-ai-action]"))){i=!0;break}}}else if("attributes"===a.type){var f=a.target;if("data-ai-field"===a.attributeName||"data-ai-action"===a.attributeName||f.hasAttribute("data-ai-field")||f.hasAttribute("data-ai-action")){i=!0;break}}if(i)break}}catch(t){r.e(t)}finally{r.f()}i&&t.buildActionMap()})),this.observer.observe(document.documentElement,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["data-ai-field","data-ai-action","value","disabled"]})}}])}(),p=function(){return o((function t(e){r(this,t),this.elementCache=new Map,this.actionMap=e}),[{key:"updateActionMap",value:function(t){this.actionMap=t,this.elementCache.clear()}},{key:"executeActions",value:(l=i(h().mark((function t(e){var n,i,r;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,n=s(e),t.prev=2,n.s();case 4:if((i=n.n()).done){t.next=12;break}return r=i.value,t.next=8,this.executeAction(r);case 8:return t.next=10,this.delay(300);case 10:t.next=4;break;case 12:t.next=17;break;case 14:t.prev=14,t.t0=t.catch(2),n.e(t.t0);case 17:return t.prev=17,n.f(),t.finish(17);case 20:return t.abrupt("return",!0);case 23:return t.prev=23,t.t1=t.catch(0),console.error("Error executing actions:",t.t1),t.abrupt("return",!1);case 27:case"end":return t.stop()}}),t,this,[[0,23],[2,14,17,20]])}))),function(t){return l.apply(this,arguments)})},{key:"executeAction",value:(u=i(h().mark((function t(e){var n;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.findElementById(e.elementId)){t.next=3;break}throw new Error("Element with ID ".concat(e.elementId," not found"));case 3:this.highlightElement(n),t.t0=e.type,t.next="fill"===t.t0?7:"click"===t.t0?10:"select"===t.t0?13:"scroll"===t.t0?16:"custom"===t.t0?19:22;break;case 7:return t.next=9,this.fillField(n,e.value||"");case 9:case 12:case 15:case 18:case 21:return t.abrupt("break",23);case 10:return t.next=12,this.clickElement(n);case 13:return t.next=15,this.selectOption(n,e.value||"");case 16:return t.next=18,this.scrollToElement(n);case 19:return t.next=21,this.executeCustomAction(n,e.options);case 22:throw new Error("Unknown action type: ".concat(e.type));case 23:case"end":return t.stop()}}),t,this)}))),function(t){return u.apply(this,arguments)})},{key:"findElementById",value:function(t){if(this.elementCache.has(t))return this.elementCache.get(t)||null;var e=this.actionMap.elements.find((function(e){return e.id===t})),n=document.getElementById(t);if(!n&&e&&e.path&&e.path.length>0)try{var i=e.path.join(" > "),r=document.querySelectorAll(i);if(1===r.length)n=r[0];else if(r.length>1)for(var a=0,o=Array.from(r);a<o.length;a++){var s=o[a];if("field"===e.type&&s.getAttribute("data-ai-field")===e.name){n=s;break}if("action"===e.type&&s.getAttribute("data-ai-action")===e.name){n=s;break}}}catch(t){console.error("Error finding element by path:",t)}if(!n&&t.startsWith("action-"))if(t.includes("clear")){var c=document.querySelectorAll('[data-ai-action="clear_form"]');c.length>0&&(n=c[0],console.log("Fallback: Found clear button by data-ai-action"))}else{var u=document.querySelectorAll('[data-ai-action="submit_form"]');u.length>0&&(n=u[0],console.log("Fallback: Found submit button by data-ai-action"))}return n&&this.elementCache.set(t,n),n}},{key:"highlightElement",value:function(t){var e=t.style.outline,n=t.style.transition;t.style.outline="2px solid #0088ff",t.style.transition="outline 0.2s ease-in-out",setTimeout((function(){t.style.outline=e,t.style.transition=n}),1e3)}},{key:"fillField",value:(c=i(h().mark((function t(e,n){var i,r,a,o;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement)){t.next=19;break}e.value="",e.focus(),i=0;case 4:if(!(i<n.length)){t.next=14;break}return r=n.charAt(i),e.value+=r,a=new Event("input",{bubbles:!0}),e.dispatchEvent(a),t.next=11,this.delay(50);case 11:i++,t.next=4;break;case 14:o=new Event("change",{bubbles:!0}),e.dispatchEvent(o),e.blur(),t.next=20;break;case 19:throw new Error("Element is not an input field");case 20:case"end":return t.stop()}}),t,this)}))),function(t,e){return c.apply(this,arguments)})},{key:"clickElement",value:(a=i(h().mark((function t(e){var n,i,r;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.scrollToElement(e);case 2:return n=new MouseEvent("mousedown",{bubbles:!0,cancelable:!0,view:window}),e.dispatchEvent(n),t.next=6,this.delay(50);case 6:i=new MouseEvent("mouseup",{bubbles:!0,cancelable:!0,view:window}),e.dispatchEvent(i),r=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window}),e.dispatchEvent(r);case 10:case"end":return t.stop()}}),t,this)}))),function(t){return a.apply(this,arguments)})},{key:"selectOption",value:(n=i(h().mark((function t(e,n){var i,r,a,o,s;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e instanceof HTMLSelectElement)){t.next=18;break}i=!1,r=0,a=Array.from(e.options);case 3:if(!(r<a.length)){t.next=12;break}if((o=a[r]).value!==n&&o.text!==n){t.next=9;break}return e.value=o.value,i=!0,t.abrupt("break",12);case 9:r++,t.next=3;break;case 12:if(i){t.next=14;break}throw new Error('Option with value or text "'.concat(n,'" not found in select element'));case 14:s=new Event("change",{bubbles:!0}),e.dispatchEvent(s),t.next=19;break;case 18:throw new Error("Element is not a select element");case 19:case"end":return t.stop()}}),t)}))),function(t,e){return n.apply(this,arguments)})},{key:"scrollToElement",value:(e=i(h().mark((function t(e){var n;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((n=e.getBoundingClientRect()).top>=0&&n.left>=0&&n.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&n.right<=(window.innerWidth||document.documentElement.clientWidth)){t.next=6;break}return e.scrollIntoView({behavior:"smooth",block:"center"}),t.next=6,this.delay(500);case 6:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"executeCustomAction",value:(t=i(h().mark((function t(e,n){var i,r,a;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n||!n.type){t.next=14;break}t.t0=n.type,t.next="hover"===t.t0?4:"focus"===t.t0?7:"blur"===t.t0?9:"setValue"===t.t0?11:13;break;case 4:return i=new MouseEvent("mouseover",{bubbles:!0,cancelable:!0,view:window}),e.dispatchEvent(i),t.abrupt("break",14);case 7:return e.focus(),t.abrupt("break",14);case 9:return e.blur(),t.abrupt("break",14);case 11:return(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement)&&(e.value=n.value||"",r=new Event("input",{bubbles:!0}),e.dispatchEvent(r),a=new Event("change",{bubbles:!0}),e.dispatchEvent(a)),t.abrupt("break",14);case 13:throw new Error("Unknown custom action type: ".concat(n.type));case 14:case"end":return t.stop()}}),t)}))),function(e,n){return t.apply(this,arguments)})},{key:"delay",value:function(t){return new Promise((function(e){return setTimeout(e,t)}))}}]);var t,e,n,a,c,u,l}(),g=function(){return o((function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"https://api.notific.ai/v1";r(this,t),this.sessionId=null,this.apiKey=e,this.endpoint=n.endsWith("/")?n.slice(0,-1):n}),[{key:"sendMessage",value:(n=i(h().mark((function t(e,n){var i,r,a,o,s,c=arguments;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=c.length>2&&void 0!==c[2]?c[2]:{},r="".concat(this.endpoint,"/api/interactive/process"),a=l(l({message:e,actionMap:n},this.sessionId?{sessionId:this.sessionId}:{}),{},{pageContext:i}),t.prev=3,t.next=6,fetch(r,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.apiKey)},body:JSON.stringify(a),mode:"cors",credentials:"include"});case 6:if((o=t.sent).ok){t.next=9;break}throw new Error("API request failed with status ".concat(o.status));case 9:return t.next=11,o.json();case 11:return(s=t.sent).sessionId&&(this.sessionId=s.sessionId),t.abrupt("return",s);case 16:return t.prev=16,t.t0=t.catch(3),console.error("Error sending message to API:",t.t0),t.abrupt("return",{response:{actions:[],message:{id:"error-".concat(Date.now()),role:"assistant",content:"Sorry, I encountered an error processing your request. Please try again later.",timestamp:Date.now()}},sessionId:this.sessionId||"fallback-".concat(Date.now())});case 20:case"end":return t.stop()}}),t,this,[[3,16]])}))),function(t,e){return n.apply(this,arguments)})},{key:"sendFeedback",value:(e=i(h().mark((function t(e,n,i){var r,a;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.sessionId){t.next=2;break}return t.abrupt("return",!1);case 2:return r="".concat(this.endpoint,"/api/interactive/feedback"),t.prev=3,t.next=6,fetch(r,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.apiKey)},body:JSON.stringify({sessionId:this.sessionId,messageId:e,feedback:n,comment:i}),mode:"cors",credentials:"include"});case 6:return a=t.sent,t.abrupt("return",a.ok);case 10:return t.prev=10,t.t0=t.catch(3),console.error("Error sending feedback:",t.t0),t.abrupt("return",!1);case 14:case"end":return t.stop()}}),t,this,[[3,10]])}))),function(t,n,i){return e.apply(this,arguments)})},{key:"getConversationHistory",value:(t=i(h().mark((function t(){var e,n,i;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.sessionId){t.next=2;break}return t.abrupt("return",[]);case 2:return e="".concat(this.endpoint,"/api/interactive/conversation/").concat(this.sessionId),t.prev=3,t.next=6,fetch(e,{method:"GET",headers:{Authorization:"Bearer ".concat(this.apiKey)},mode:"cors",credentials:"include"});case 6:if((n=t.sent).ok){t.next=9;break}throw new Error("API request failed with status ".concat(n.status));case 9:return t.next=11,n.json();case 11:return i=t.sent,t.abrupt("return",i.messages||[]);case 15:return t.prev=15,t.t0=t.catch(3),console.error("Error fetching conversation history:",t.t0),t.abrupt("return",[]);case 19:case"end":return t.stop()}}),t,this,[[3,15]])}))),function(){return t.apply(this,arguments)})}]);var t,e,n}(),v=function(){return o((function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{position:"right"};r(this,t),this.container=null,this.messageList=null,this.inputField=null,this.isOpen=!1,this.onSendMessage=e,this.options=this.mergeWithDefaultOptions(n)}),[{key:"init",value:function(){this.createWidgetDOM(),this.attachEventListeners()}},{key:"show",value:function(){var t=this;this.container&&(this.container.style.display="block",setTimeout((function(){t.container&&t.container.classList.add("notific-widget-visible")}),10),this.isOpen=!0)}},{key:"hide",value:function(){var t=this;this.container&&(this.container.classList.remove("notific-widget-visible"),setTimeout((function(){t.container&&(t.container.style.display="none")}),300),this.isOpen=!1)}},{key:"toggle",value:function(){this.isOpen?this.hide():this.show()}},{key:"addMessage",value:function(t){if(this.messageList){var e=document.createElement("div");e.className="notific-message notific-message-".concat(t.role),e.setAttribute("data-message-id",t.id);var n=document.createElement("div");n.className="notific-message-content",n.textContent=t.content,e.appendChild(n),this.messageList.appendChild(e),this.messageList.scrollTop=this.messageList.scrollHeight}}},{key:"updateMessages",value:function(t){if(this.messageList){this.messageList.innerHTML="";var e,n=s(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;this.addMessage(i)}}catch(t){n.e(t)}finally{n.f()}}}},{key:"destroy",value:function(){this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container);var t=document.getElementById("notific-chat-widget-styles");t&&t.parentNode&&t.parentNode.removeChild(t)}},{key:"createWidgetDOM",value:function(){this.addStyles(),this.container=document.createElement("div"),this.container.className="notific-chat-widget",this.container.classList.add("notific-position-".concat(this.options.position));var t=document.createElement("button");t.className="notific-toggle-button",t.setAttribute("aria-label","Toggle chat assistant"),t.innerHTML='\n      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>\n      </svg>\n    ';var e=document.createElement("div");e.className="notific-chat-container";var n=document.createElement("div");n.className="notific-chat-header";var i=document.createElement("div");i.className="notific-header-title",i.textContent="AI Assistant";var r=document.createElement("button");r.className="notific-close-button",r.setAttribute("aria-label","Close chat"),r.innerHTML="&times;",n.appendChild(i),n.appendChild(r),this.messageList=document.createElement("div"),this.messageList.className="notific-message-list";var a=document.createElement("div");a.className="notific-input-area",this.inputField=document.createElement("textarea"),this.inputField.className="notific-input-field",this.inputField.placeholder=this.options.placeholder||"Type your message...",this.inputField.rows=1;var o=document.createElement("button");o.className="notific-send-button",o.setAttribute("aria-label","Send message"),o.innerHTML='\n      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n        <line x1="22" y1="2" x2="11" y2="13"></line>\n        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>\n      </svg>\n    ',a.appendChild(this.inputField),a.appendChild(o),e.appendChild(n),e.appendChild(this.messageList),e.appendChild(a),this.container.appendChild(t),this.container.appendChild(e),document.body.appendChild(this.container),this.options.greeting&&this.addMessage({id:"greeting",role:"system",content:this.options.greeting,timestamp:Date.now()})}},{key:"addStyles",value:function(){var t=this.options.theme||{},e=t.primaryColor,n=void 0===e?"#0088ff":e,i=t.textColor,r=void 0===i?"#333":i,a=t.fontFamily,o="\n      .notific-chat-widget {\n        position: fixed;\n        bottom: 20px;\n        z-index: 9999;\n        display: none;\n        font-family: ".concat(void 0===a?"system-ui, -apple-system, BlinkMacSystemFont, sans-serif":a,";\n        transition: opacity 0.3s, transform 0.3s;\n        opacity: 0;\n        transform: translateY(20px);\n      }\n\n      .notific-widget-visible {\n        opacity: 1;\n        transform: translateY(0);\n      }\n\n      .notific-position-right {\n        right: 20px;\n      }\n\n      .notific-position-left {\n        left: 20px;\n      }\n\n      .notific-toggle-button {\n        position: absolute;\n        bottom: 0;\n        right: 0;\n        width: 50px;\n        height: 50px;\n        border-radius: 50%;\n        background-color: ").concat(n,";\n        color: white;\n        border: none;\n        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 2;\n      }\n\n      .notific-chat-container {\n        position: absolute;\n        bottom: 70px;\n        right: 0;\n        width: 320px;\n        height: 400px;\n        border-radius: 12px;\n        background-color: white;\n        box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n      }\n\n      .notific-position-left .notific-chat-container {\n        right: auto;\n        left: 0;\n      }\n\n      .notific-chat-header {\n        padding: 12px 16px;\n        background-color: ").concat(n,";\n        color: white;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n      }\n\n      .notific-header-title {\n        font-weight: bold;\n      }\n\n      .notific-close-button {\n        background: none;\n        border: none;\n        color: white;\n        font-size: 24px;\n        cursor: pointer;\n        padding: 0;\n        line-height: 1;\n      }\n\n      .notific-message-list {\n        flex: 1;\n        overflow-y: auto;\n        padding: 16px;\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n      }\n\n      .notific-message {\n        max-width: 80%;\n        padding: 10px 14px;\n        border-radius: 16px;\n        position: relative;\n        word-wrap: break-word;\n      }\n\n      .notific-message-user {\n        align-self: flex-end;\n        background-color: ").concat(n,";\n        color: white;\n        border-bottom-right-radius: 4px;\n      }\n\n      .notific-message-assistant {\n        align-self: flex-start;\n        background-color: #f0f0f0;\n        color: ").concat(r,";\n        border-bottom-left-radius: 4px;\n      }\n\n      .notific-message-system {\n        align-self: center;\n        background-color: #f8f8f8;\n        color: #666;\n        border-radius: 8px;\n        font-style: italic;\n        max-width: 90%;\n      }\n\n      .notific-input-area {\n        padding: 12px;\n        border-top: 1px solid #eee;\n        display: flex;\n        align-items: center;\n        gap: 10px;\n      }\n\n      .notific-input-field {\n        flex: 1;\n        resize: none;\n        height: 40px;\n        max-height: 120px;\n        padding: 10px 14px;\n        border: 1px solid #ddd;\n        border-radius: 20px;\n        font-family: inherit;\n        font-size: 14px;\n        outline: none;\n      }\n\n      .notific-input-field:focus {\n        border-color: ").concat(n,";\n      }\n\n      .notific-send-button {\n        width: 40px;\n        height: 40px;\n        border-radius: 50%;\n        background-color: ").concat(n,";\n        color: white;\n        border: none;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .notific-send-button:disabled {\n        background-color: #ccc;\n        cursor: not-allowed;\n      }\n\n      @media (max-width: 480px) {\n        .notific-chat-container {\n          width: 280px;\n          height: 350px;\n        }\n      }\n    ")+(this.options.customCSS||""),s=document.createElement("style");s.id="notific-chat-widget-styles",s.textContent=o,document.head.appendChild(s)}},{key:"attachEventListeners",value:function(){var t=this;if(this.container){var e=this.container.querySelector(".notific-toggle-button");e&&e.addEventListener("click",(function(){return t.toggle()}));var n=this.container.querySelector(".notific-close-button");n&&n.addEventListener("click",(function(){return t.hide()}));var i=this.container.querySelector(".notific-send-button");i&&this.inputField&&i.addEventListener("click",(function(){return t.handleSendMessage()})),this.inputField&&(this.inputField.addEventListener("keypress",(function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),t.handleSendMessage())})),this.inputField.addEventListener("input",(function(){t.inputField.style.height="auto",t.inputField.style.height=Math.min(t.inputField.scrollHeight,120)+"px"})))}}},{key:"handleSendMessage",value:function(){if(this.inputField){var t=this.inputField.value.trim();t&&(this.inputField.value="",this.inputField.style.height="auto",this.addMessage({id:"user-".concat(Date.now()),role:"user",content:t,timestamp:Date.now()}),this.onSendMessage(t))}}},{key:"mergeWithDefaultOptions",value:function(t){var e,n,i;return{position:t.position||"right",theme:{primaryColor:(null===(e=t.theme)||void 0===e?void 0:e.primaryColor)||"#0088ff",textColor:(null===(n=t.theme)||void 0===n?void 0:n.textColor)||"#333",fontFamily:(null===(i=t.theme)||void 0===i?void 0:i.fontFamily)||"system-ui, -apple-system, BlinkMacSystemFont, sans-serif"},placeholder:t.placeholder||"Type your message...",greeting:t.greeting||"Hello! How can I help you today?",customCSS:t.customCSS||""}}}])}();function m(){return"".concat(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"notific","-").concat(Date.now(),"-").concat(Math.random().toString(36).substring(2,9))}function y(t,e){if(t){for(var n,i=arguments.length,r=new Array(i>2?i-2:0),a=2;a<i;a++)r[a-2]=arguments[a];(n=console).log.apply(n,["[NotificAI] ".concat(e)].concat(r))}}var b=function(){return o((function t(e){r(this,t),this.actionMapBuilder=null,this.actionExecutor=null,this.apiClient=null,this.chatWidget=null,this.messages=[],this.initialized=!1,this.config=l({apiKey:"",endpoint:"https://api.notific.ai/v1",debug:!1,chatWidget:{enable:!0,position:"right"}},e),t._instance=this}),[{key:"init",value:function(t){var e,n=this;if(this.initialized)return y(this.config.debug||!1,"SDK already initialized"),this;if(t&&(this.config=l(l({},this.config),t)),!this.config.apiKey)throw new Error("API key is required");y(this.config.debug||!1,"Initializing SDK",this.config),this.actionMapBuilder=new f,this.actionMapBuilder.init();var i=this.actionMapBuilder.getActionMap();if(this.actionExecutor=new p(i),this.apiClient=new g(this.config.apiKey,this.config.endpoint),null===(e=this.config.chatWidget)||void 0===e?void 0:e.enable){var r={position:this.config.chatWidget.position||"right",customCSS:this.config.chatWidget.customCSS};this.chatWidget=new v((function(t){return n.handleUserMessage(t)}),r),this.chatWidget.init()}return this.initialized=!0,this}},{key:"show",value:function(){this.initialized||this.init(),this.chatWidget&&this.chatWidget.show()}},{key:"hide",value:function(){this.chatWidget&&this.chatWidget.hide()}},{key:"destroy",value:function(){this.actionMapBuilder&&(this.actionMapBuilder.destroy(),this.actionMapBuilder=null),this.chatWidget&&(this.chatWidget.destroy(),this.chatWidget=null),this.actionExecutor=null,this.apiClient=null,this.messages=[],this.initialized=!1,y(this.config.debug||!1,"SDK destroyed")}},{key:"sendMessage",value:(e=i(h().mark((function t(e){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.initialized||this.init(),t.next=3,this.handleUserMessage(e);case 3:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"handleUserMessage",value:(t=i(h().mark((function t(e){var n,i,r,a,o,s;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.actionMapBuilder&&this.actionExecutor&&this.apiClient){t.next=2;break}throw new Error("SDK not initialized properly");case 2:return n={id:m("user"),role:"user",content:e,timestamp:Date.now()},this.messages.push(n),i={id:m("loading"),role:"assistant",content:"...",timestamp:Date.now()},this.messages.push(i),this.chatWidget&&this.chatWidget.updateMessages(this.messages),t.prev=7,r=this.actionMapBuilder.getActionMap(),this.actionExecutor.updateActionMap(r),a={url:window.location.href,title:document.title,path:window.location.pathname,referrer:document.referrer||window.location.origin,userAgent:navigator.userAgent,screenWidth:window.screen.width,screenHeight:window.screen.height,viewportWidth:window.innerWidth,viewportHeight:window.innerHeight,timestamp:Date.now()},t.next=13,this.apiClient.sendMessage(e,r,a);case 13:o=t.sent,this.messages=this.messages.filter((function(t){return t.id!==i.id})),o.response.message&&this.messages.push(o.response.message),this.chatWidget&&this.chatWidget.updateMessages(this.messages),o.response.actions&&o.response.actions.length>0&&(y(this.config.debug||!1,"Executing actions",o.response.actions),this.actionExecutor.executeActions(o.response.actions)),t.next=27;break;case 20:t.prev=20,t.t0=t.catch(7),this.messages=this.messages.filter((function(t){return t.id!==i.id})),s={id:m("error"),role:"system",content:"Sorry, there was an error processing your request.",timestamp:Date.now()},this.messages.push(s),this.chatWidget&&this.chatWidget.updateMessages(this.messages),console.error("Error handling user message:",t.t0);case 27:case"end":return t.stop()}}),t,this,[[7,20]])}))),function(e){return t.apply(this,arguments)})},{key:"getMessages",value:function(){return this.messages}},{key:"getActionMap",value:function(){return this.actionMapBuilder?this.actionMapBuilder.getActionMap():null}}]);var t,e}();b._instance=null,"undefined"!=typeof document&&document.addEventListener("DOMContentLoaded",(function(){var t=document.querySelector("script[data-api-key]");if(t){var e=t.getAttribute("data-api-key");if(e){var n=t.getAttribute("data-position"),i=t.hasAttribute("data-debug"),r=new b({apiKey:e,debug:i,chatWidget:{enable:!0,position:n||"right"}});r.init(),window.NotificAI=r}}}));var w=b;t.NotificAI=w,t.default=b,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=notific-ai-sdk.umd.js.map
