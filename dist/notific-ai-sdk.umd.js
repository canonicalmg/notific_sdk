!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).NotificAI={})}(this,(function(t){"use strict";function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function n(t,e,n,i,r,o,a){try{var s=t[o](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(i,r)}function i(t){return function(){var e=this,i=arguments;return new Promise((function(r,o){var a=t.apply(e,i);function s(t){n(a,r,o,s,c,"next",t)}function c(t){n(a,r,o,s,c,"throw",t)}s(void 0)}))}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,h(i.key),i)}}function a(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t,n){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,n){if(t){if("string"==typeof t)return e(t,n);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?e(t,n):void 0}}(t))||n&&t&&"number"==typeof t.length){i&&(t=i);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){c=!0,a=t},f:function(){try{s||null==i.return||i.return()}finally{if(c)throw a}}}}function c(t,e,n){return(e=h(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function u(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){c(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function d(){d=function(){return e};var t,e={},n=Object.prototype,i=n.hasOwnProperty,r=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function l(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,n){return t[e]=n}}function u(t,e,n,i){var o=e&&e.prototype instanceof y?e:y,a=Object.create(o.prototype),s=new j(i||[]);return r(a,"_invoke",{value:L(t,n,s)}),a}function h(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var f="suspendedStart",p="suspendedYield",g="executing",m="completed",v={};function y(){}function b(){}function w(){}var x={};l(x,a,(function(){return this}));var k=Object.getPrototypeOf,E=k&&k(k(N([])));E&&E!==n&&i.call(E,a)&&(x=E);var A=w.prototype=y.prototype=Object.create(x);function M(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function C(t,e){function n(r,o,a,s){var c=h(t[r],t,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==typeof u&&i.call(u,"__await")?e.resolve(u.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(u).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var o;r(this,"_invoke",{value:function(t,i){function r(){return new e((function(e,r){n(t,i,e,r)}))}return o=o?o.then(r,r):r()}})}function L(e,n,i){var r=f;return function(o,a){if(r===g)throw Error("Generator is already running");if(r===m){if("throw"===o)throw a;return{value:t,done:!0}}for(i.method=o,i.arg=a;;){var s=i.delegate;if(s){var c=S(s,i);if(c){if(c===v)continue;return c}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(r===f)throw r=m,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r=g;var l=h(e,n,i);if("normal"===l.type){if(r=i.done?m:p,l.arg===v)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(r=m,i.method="throw",i.arg=l.arg)}}}function S(e,n){var i=n.method,r=e.iterator[i];if(r===t)return n.delegate=null,"throw"===i&&e.iterator.return&&(n.method="return",n.arg=t,S(e,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),v;var o=h(r,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,v;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,v):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function j(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function N(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function n(){for(;++r<e.length;)if(i.call(e,r))return n.value=e[r],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(typeof e+" is not iterable")}return b.prototype=w,r(A,"constructor",{value:w,configurable:!0}),r(w,"constructor",{value:b,configurable:!0}),b.displayName=l(w,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,l(t,c,"GeneratorFunction")),t.prototype=Object.create(A),t},e.awrap=function(t){return{__await:t}},M(C.prototype),l(C.prototype,s,(function(){return this})),e.AsyncIterator=C,e.async=function(t,n,i,r,o){void 0===o&&(o=Promise);var a=new C(u(t,n,i,r),o);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},M(A),l(A,c,"Generator"),l(A,a,(function(){return this})),l(A,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var i in e)n.push(i);return n.reverse(),function t(){for(;n.length;){var i=n.pop();if(i in e)return t.value=i,t.done=!1,t}return t.done=!0,t}},e.values=N,j.prototype={constructor:j,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(i,r){return s.type="throw",s.arg=e,n.next=i,r&&(n.method="next",n.arg=t),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=i.call(a,"catchLoc"),l=i.call(a,"finallyLoc");if(c&&l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),I(n),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var r=i.arg;I(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(e,n,i){return this.delegate={iterator:N(e),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=t),v}},e}function h(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}var f=function(){return a((function t(){r(this,t),this.observer=null,this.actionCatalog={},this.actionMap=this.createEmptyActionMap()}),[{key:"init",value:function(){this.buildActionMap(),this.buildActionCatalog(),this.observeDOM()}},{key:"destroy",value:function(){this.observer&&(this.observer.disconnect(),this.observer=null)}},{key:"getActionMap",value:function(){return this.actionMap.timestamp=Date.now(),this.actionMap}},{key:"createEmptyActionMap",value:function(){return{url:window.location.href,title:document.title,elements:[],actionCatalog:{},timestamp:Date.now()}}},{key:"buildActionCatalog",value:function(){this.actionCatalog={},console.log("Building simplified action catalog for MVP"),this.actionMap.actionCatalog=this.actionCatalog}},{key:"buildActionMap",value:function(){var t=this;this.actionMap=this.createEmptyActionMap();var e=document.querySelectorAll("[data-ai-field]"),n=document.querySelectorAll("[data-ai-action]");e.forEach((function(e){var n=t.processFieldElement(e);n&&t.actionMap.elements.push(n)})),n.forEach((function(e){var n=t.processActionElement(e);n&&t.actionMap.elements.push(n)}))}},{key:"processFieldElement",value:function(t){var e=t.getAttribute("data-ai-field");if(!e)return null;var n,i,r=t.getBoundingClientRect(),o=t.tagName.toLowerCase();if("input"===o||"textarea"===o)n=t.value;else if("select"===o){var a=t;n=a.value,i=Array.from(a.options).map((function(t){return t.text}))}var s=this.findLabelForElement(t),c=this.getDomPath(t);return{id:this.generateElementId(t),type:"field",name:e,value:n,position:{x:r.left+window.scrollX,y:r.top+window.scrollY},elementType:o,label:s,options:i,required:t.hasAttribute("required"),disabled:t.hasAttribute("disabled"),path:c}}},{key:"processActionElement",value:function(t){var e,n=t.getAttribute("data-ai-action");if(!n)return null;var i=t.getBoundingClientRect(),r=t.tagName.toLowerCase(),o=(null===(e=t.textContent)||void 0===e?void 0:e.trim())||void 0;if(!o||""===o){var a=t.getAttribute("aria-label");a&&(o=a)}var s=this.getDomPath(t),c=t.getAttribute("data-ai-provides-access"),l=t.getAttribute("data-ai-action-param"),u={id:this.generateElementId(t),type:"action",name:n,position:{x:i.left+window.scrollX,y:i.top+window.scrollY},elementType:r,label:o,disabled:t.hasAttribute("disabled"),path:s};return c&&(u.providesAccess=c.split(",").map((function(t){return t.trim()}))),l&&(u.accessParam=l),u}},{key:"findLabelForElement",value:function(t){if(t.id){var e=document.querySelector('label[for="'.concat(t.id,'"]'));if(e&&e.textContent)return e.textContent.trim()}for(var n=t.parentElement;n;){if("label"===n.tagName.toLowerCase()&&n.textContent)return n.textContent.trim();n=n.parentElement}var i=t.getAttribute("aria-label");if(i)return i;var r=t.getAttribute("placeholder");return r||void 0}},{key:"generateElementId",value:function(t){if(t.id)return t.id;var e=t.getAttribute("data-ai-field")?"field":t.getAttribute("data-ai-action")?"action":"element",n=t.getAttribute("data-ai-field")||t.getAttribute("data-ai-action")||t.tagName.toLowerCase(),i=Math.random().toString(36).substring(2,8);return"notific-".concat(e,"-").concat(n,"-").concat(i)}},{key:"getDomPath",value:function(t){for(var e=[],n=t;n;){var i=n.tagName.toLowerCase();if(n.id)i+="#".concat(n.id);else if(n.className&&"string"==typeof n.className){var r=n.className.split(/\s+/).filter(Boolean);r.length&&(i+=".".concat(r.join(".")))}e.unshift(i),n=n.parentElement}return e}},{key:"observeDOM",value:function(){var t=this;this.observer=new MutationObserver((function(e){var n,i=!1,r=s(e);try{for(r.s();!(n=r.n()).done;){var o=n.value;if("childList"===o.type){for(var a=0,c=Array.from(o.addedNodes);a<c.length;a++){var l=c[a];if(l instanceof HTMLElement&&(l.hasAttribute("data-ai-field")||l.hasAttribute("data-ai-action")||l.querySelector("[data-ai-field], [data-ai-action]"))){i=!0;break}}for(var u=0,d=Array.from(o.removedNodes);u<d.length;u++){var h=d[u];if(h instanceof HTMLElement&&(h.hasAttribute("data-ai-field")||h.hasAttribute("data-ai-action")||h.querySelector("[data-ai-field], [data-ai-action]"))){i=!0;break}}}else if("attributes"===o.type){var f=o.target;if("data-ai-field"===o.attributeName||"data-ai-action"===o.attributeName||f.hasAttribute("data-ai-field")||f.hasAttribute("data-ai-action")){i=!0;break}}if(i)break}}catch(t){r.e(t)}finally{r.f()}i&&t.buildActionMap()})),this.observer.observe(document.documentElement,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["data-ai-field","data-ai-action","value","disabled"]})}}])}(),p=function(){return a((function t(e){r(this,t),this.elementCache=new Map,this.actionMap=e}),[{key:"updateActionMap",value:function(t){this.actionMap=t,this.elementCache.clear()}},{key:"checkNavigationSteps",value:function(t){return console.log("Simplified MVP: skipping navigation steps for action: ".concat(t)),null}},{key:"executeActions",value:(u=i(d().mark((function t(e){var n,i,r;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,console.log("Executing ".concat(e.length," action(s):")),n=s(e),t.prev=3,n.s();case 5:if((i=n.n()).done){t.next=20;break}return r=i.value,console.log("Processing action: ".concat(r.type," on element ").concat(r.elementId)),t.prev=8,t.next=11,this.executeAction(r);case 11:return t.next=13,this.delay(300);case 13:t.next=18;break;case 15:t.prev=15,t.t0=t.catch(8),console.error("Error executing action ".concat(r.elementId,":"),t.t0);case 18:t.next=5;break;case 20:t.next=25;break;case 22:t.prev=22,t.t1=t.catch(3),n.e(t.t1);case 25:return t.prev=25,n.f(),t.finish(25);case 28:return t.abrupt("return",!0);case 31:return t.prev=31,t.t2=t.catch(0),console.error("Error executing actions:",t.t2),t.abrupt("return",!1);case 35:case"end":return t.stop()}}),t,this,[[0,31],[3,22,25,28],[8,15]])}))),function(t){return u.apply(this,arguments)})},{key:"executeAction",value:(l=i(d().mark((function t(e){var n,i,r;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=this.findElementById(e.elementId))&&e.elementId.includes("notific-action-")&&(i=e.elementId.replace("notific-action-",""),console.log("Element not found by ID, trying to find by action name: ".concat(i)),(r=document.querySelectorAll('[data-ai-action="'.concat(i,'"]'))).length>0&&(n=r[0],console.log("Found element by data-ai-action: ".concat(i)))),n){t.next=4;break}throw new Error("Element with ID ".concat(e.elementId," not found"));case 4:this.highlightElement(n),t.t0=e.type,t.next="fill"===t.t0?8:"click"===t.t0?11:"select"===t.t0?14:"scroll"===t.t0?17:"custom"===t.t0?20:23;break;case 8:return t.next=10,this.fillField(n,e.value||"");case 10:case 13:case 16:case 19:case 22:return t.abrupt("break",24);case 11:return t.next=13,this.clickElement(n);case 14:return t.next=16,this.selectOption(n,e.value||"");case 17:return t.next=19,this.scrollToElement(n);case 20:return t.next=22,this.executeCustomAction(n,e.options);case 23:throw new Error("Unknown action type: ".concat(e.type));case 24:case"end":return t.stop()}}),t,this)}))),function(t){return l.apply(this,arguments)})},{key:"findElementById",value:function(t){if(this.elementCache.has(t))return this.elementCache.get(t)||null;this.actionMap.elements.find((function(e){return e.id===t}));var e=document.getElementById(t);if(!e&&t.startsWith("notific-action-")){var n=t.replace("notific-action-","").split("-")[0],i=document.querySelectorAll('[data-ai-action="'.concat(n,'"]'));i.length>0&&(e=i[0],console.log("Found element by data-ai-action: ".concat(n)))}if(!e&&t.startsWith("notific-field-")){var r="",o=t.split("-");o.length>=3&&(r=o.length>3&&o.length>4?o.slice(2,-1).join("-"):o[2]),console.log("Trying to find field by data-ai-field: ".concat(r));var a=document.querySelectorAll('[data-ai-field="'.concat(r,'"]'));if(a.length>0)e=a[0],console.log("Found element by data-ai-field: ".concat(r));else if(r.includes("-")){var s=r.split("-")[0],c=document.querySelectorAll('[data-ai-field="'.concat(s,'"]'));if(c.length>0)e=c[0],console.log("Found element by simplified data-ai-field: ".concat(s));else for(var l=document.querySelectorAll("[data-ai-field]"),u=0,d=Array.from(l);u<d.length;u++){var h=d[u],f=h.getAttribute("data-ai-field");if(f&&(r.startsWith(f)||f.startsWith(r))){e=h,console.log("Found element by partial field match: ".concat(f));break}}}}return e&&this.elementCache.set(t,e),e}},{key:"highlightElement",value:function(t){var e=t.style.outline,n=t.style.transition;t.style.outline="2px solid #0088ff",t.style.transition="outline 0.2s ease-in-out",setTimeout((function(){t.style.outline=e,t.style.transition=n}),1e3)}},{key:"fillField",value:(c=i(d().mark((function t(e,n){var i,r,o,a;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement)){t.next=19;break}e.value="",e.focus(),i=0;case 4:if(!(i<n.length)){t.next=14;break}return r=n.charAt(i),e.value+=r,o=new Event("input",{bubbles:!0}),e.dispatchEvent(o),t.next=11,this.delay(50);case 11:i++,t.next=4;break;case 14:a=new Event("change",{bubbles:!0}),e.dispatchEvent(a),e.blur(),t.next=20;break;case 19:throw new Error("Element is not an input field");case 20:case"end":return t.stop()}}),t,this)}))),function(t,e){return c.apply(this,arguments)})},{key:"clickElement",value:(o=i(d().mark((function t(e){var n,i,r;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.scrollToElement(e);case 2:return n=new MouseEvent("mousedown",{bubbles:!0,cancelable:!0,view:window}),e.dispatchEvent(n),t.next=6,this.delay(50);case 6:i=new MouseEvent("mouseup",{bubbles:!0,cancelable:!0,view:window}),e.dispatchEvent(i),r=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window}),e.dispatchEvent(r);case 10:case"end":return t.stop()}}),t,this)}))),function(t){return o.apply(this,arguments)})},{key:"selectOption",value:(n=i(d().mark((function t(e,n){var i,r,o,a,s;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e instanceof HTMLSelectElement)){t.next=18;break}i=!1,r=0,o=Array.from(e.options);case 3:if(!(r<o.length)){t.next=12;break}if((a=o[r]).value!==n&&a.text!==n){t.next=9;break}return e.value=a.value,i=!0,t.abrupt("break",12);case 9:r++,t.next=3;break;case 12:if(i){t.next=14;break}throw new Error('Option with value or text "'.concat(n,'" not found in select element'));case 14:s=new Event("change",{bubbles:!0}),e.dispatchEvent(s),t.next=19;break;case 18:throw new Error("Element is not a select element");case 19:case"end":return t.stop()}}),t)}))),function(t,e){return n.apply(this,arguments)})},{key:"scrollToElement",value:(e=i(d().mark((function t(e){var n;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((n=e.getBoundingClientRect()).top>=0&&n.left>=0&&n.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&n.right<=(window.innerWidth||document.documentElement.clientWidth)){t.next=6;break}return e.scrollIntoView({behavior:"smooth",block:"center"}),t.next=6,this.delay(500);case 6:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"executeCustomAction",value:(t=i(d().mark((function t(e,n){var i,r,o;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n||!n.type){t.next=14;break}t.t0=n.type,t.next="hover"===t.t0?4:"focus"===t.t0?7:"blur"===t.t0?9:"setValue"===t.t0?11:13;break;case 4:return i=new MouseEvent("mouseover",{bubbles:!0,cancelable:!0,view:window}),e.dispatchEvent(i),t.abrupt("break",14);case 7:return e.focus(),t.abrupt("break",14);case 9:return e.blur(),t.abrupt("break",14);case 11:return(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement)&&(e.value=n.value||"",r=new Event("input",{bubbles:!0}),e.dispatchEvent(r),o=new Event("change",{bubbles:!0}),e.dispatchEvent(o)),t.abrupt("break",14);case 13:throw new Error("Unknown custom action type: ".concat(n.type));case 14:case"end":return t.stop()}}),t)}))),function(e,n){return t.apply(this,arguments)})},{key:"delay",value:function(t){return new Promise((function(e){return setTimeout(e,t)}))}}]);var t,e,n,o,c,l,u}(),g=function(){return a((function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"https://api.notific.ai/v1";r(this,t),this.sessionId=null,this.apiKey=e,this.endpoint=n.endsWith("/")?n.slice(0,-1):n}),[{key:"sendMessage",value:(n=i(d().mark((function t(e,n){var i,r,o,a,s,c=arguments;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=c.length>2&&void 0!==c[2]?c[2]:{},r="".concat(this.endpoint,"/api/interactive/process"),o=u(u({message:e,actionMap:n},this.sessionId?{sessionId:this.sessionId}:{}),{},{pageContext:i}),t.prev=3,t.next=6,fetch(r,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.apiKey)},body:JSON.stringify(o),mode:"cors",credentials:"include"});case 6:if((a=t.sent).ok){t.next=9;break}throw new Error("API request failed with status ".concat(a.status));case 9:return t.next=11,a.json();case 11:return(s=t.sent).sessionId&&(this.sessionId=s.sessionId),t.abrupt("return",s);case 16:return t.prev=16,t.t0=t.catch(3),console.error("Error sending message to API:",t.t0),t.abrupt("return",{response:{actions:[],message:{id:"error-".concat(Date.now()),role:"assistant",content:"Sorry, I encountered an error processing your request. Please try again later.",timestamp:Date.now()}},sessionId:this.sessionId||"fallback-".concat(Date.now())});case 20:case"end":return t.stop()}}),t,this,[[3,16]])}))),function(t,e){return n.apply(this,arguments)})},{key:"sendFeedback",value:(e=i(d().mark((function t(e,n,i){var r,o;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.sessionId){t.next=2;break}return t.abrupt("return",!1);case 2:return r="".concat(this.endpoint,"/api/interactive/feedback"),t.prev=3,t.next=6,fetch(r,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.apiKey)},body:JSON.stringify({sessionId:this.sessionId,messageId:e,feedback:n,comment:i}),mode:"cors",credentials:"include"});case 6:return o=t.sent,t.abrupt("return",o.ok);case 10:return t.prev=10,t.t0=t.catch(3),console.error("Error sending feedback:",t.t0),t.abrupt("return",!1);case 14:case"end":return t.stop()}}),t,this,[[3,10]])}))),function(t,n,i){return e.apply(this,arguments)})},{key:"getConversationHistory",value:(t=i(d().mark((function t(){var e,n,i;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.sessionId){t.next=2;break}return t.abrupt("return",[]);case 2:return e="".concat(this.endpoint,"/api/interactive/conversation/").concat(this.sessionId),t.prev=3,t.next=6,fetch(e,{method:"GET",headers:{Authorization:"Bearer ".concat(this.apiKey)},mode:"cors",credentials:"include"});case 6:if((n=t.sent).ok){t.next=9;break}throw new Error("API request failed with status ".concat(n.status));case 9:return t.next=11,n.json();case 11:return i=t.sent,t.abrupt("return",i.messages||[]);case 15:return t.prev=15,t.t0=t.catch(3),console.error("Error fetching conversation history:",t.t0),t.abrupt("return",[]);case 19:case"end":return t.stop()}}),t,this,[[3,15]])}))),function(){return t.apply(this,arguments)})}]);var t,e,n}(),m=function(){return a((function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{position:"right"};r(this,t),this.container=null,this.messageList=null,this.inputField=null,this.isOpen=!1,this.onSendMessage=e,this.options=this.mergeWithDefaultOptions(n)}),[{key:"init",value:function(){this.createWidgetDOM(),this.attachEventListeners()}},{key:"show",value:function(){var t=this;this.container&&(this.container.style.display="block",setTimeout((function(){t.container&&t.container.classList.add("notific-widget-visible")}),10),this.isOpen=!0)}},{key:"hide",value:function(){var t=this;this.container&&(this.container.classList.remove("notific-widget-visible"),setTimeout((function(){t.container&&(t.container.style.display="none")}),300),this.isOpen=!1)}},{key:"toggle",value:function(){this.isOpen?this.hide():this.show()}},{key:"addMessage",value:function(t){if(this.messageList){var e=document.createElement("div");e.className="notific-message notific-message-".concat(t.role),e.setAttribute("data-message-id",t.id);var n=document.createElement("div");n.className="notific-message-content",n.textContent=t.content,e.appendChild(n),this.messageList.appendChild(e),this.messageList.scrollTop=this.messageList.scrollHeight}}},{key:"updateMessages",value:function(t){if(this.messageList){this.messageList.innerHTML="";var e,n=s(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;this.addMessage(i)}}catch(t){n.e(t)}finally{n.f()}}}},{key:"destroy",value:function(){this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container);var t=document.getElementById("notific-chat-widget-styles");t&&t.parentNode&&t.parentNode.removeChild(t)}},{key:"createWidgetDOM",value:function(){this.addStyles(),this.container=document.createElement("div"),this.container.className="notific-chat-widget",this.container.classList.add("notific-position-".concat(this.options.position));var t=document.createElement("button");t.className="notific-toggle-button",t.setAttribute("aria-label","Toggle chat assistant"),t.innerHTML='\n      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>\n      </svg>\n    ';var e=document.createElement("div");e.className="notific-chat-container";var n=document.createElement("div");n.className="notific-chat-header";var i=document.createElement("div");i.className="notific-header-title",i.textContent="AI Assistant";var r=document.createElement("button");r.className="notific-close-button",r.setAttribute("aria-label","Close chat"),r.innerHTML="&times;",n.appendChild(i),n.appendChild(r),this.messageList=document.createElement("div"),this.messageList.className="notific-message-list";var o=document.createElement("div");o.className="notific-input-area",this.inputField=document.createElement("textarea"),this.inputField.className="notific-input-field",this.inputField.placeholder=this.options.placeholder||"Type your message...",this.inputField.rows=1;var a=document.createElement("button");a.className="notific-send-button",a.setAttribute("aria-label","Send message"),a.innerHTML='\n      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n        <line x1="22" y1="2" x2="11" y2="13"></line>\n        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>\n      </svg>\n    ',o.appendChild(this.inputField),o.appendChild(a),e.appendChild(n),e.appendChild(this.messageList),e.appendChild(o),this.container.appendChild(t),this.container.appendChild(e),document.body.appendChild(this.container),this.options.greeting&&this.addMessage({id:"greeting",role:"system",content:this.options.greeting,timestamp:Date.now()})}},{key:"addStyles",value:function(){var t=this.options.theme||{},e=t.primaryColor,n=void 0===e?"#0088ff":e,i=t.textColor,r=void 0===i?"#333":i,o=t.fontFamily,a="\n      .notific-chat-widget {\n        position: fixed;\n        bottom: 20px;\n        z-index: 9999;\n        display: none;\n        font-family: ".concat(void 0===o?"system-ui, -apple-system, BlinkMacSystemFont, sans-serif":o,";\n        transition: opacity 0.3s, transform 0.3s;\n        opacity: 0;\n        transform: translateY(20px);\n      }\n\n      .notific-widget-visible {\n        opacity: 1;\n        transform: translateY(0);\n      }\n\n      .notific-position-right {\n        right: 20px;\n      }\n\n      .notific-position-left {\n        left: 20px;\n      }\n\n      .notific-toggle-button {\n        position: absolute;\n        bottom: 0;\n        right: 0;\n        width: 50px;\n        height: 50px;\n        border-radius: 50%;\n        background-color: ").concat(n,";\n        color: white;\n        border: none;\n        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 2;\n      }\n\n      .notific-chat-container {\n        position: absolute;\n        bottom: 70px;\n        right: 0;\n        width: 320px;\n        height: 400px;\n        border-radius: 12px;\n        background-color: white;\n        box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n      }\n\n      .notific-position-left .notific-chat-container {\n        right: auto;\n        left: 0;\n      }\n\n      .notific-chat-header {\n        padding: 12px 16px;\n        background-color: ").concat(n,";\n        color: white;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n      }\n\n      .notific-header-title {\n        font-weight: bold;\n      }\n\n      .notific-close-button {\n        background: none;\n        border: none;\n        color: white;\n        font-size: 24px;\n        cursor: pointer;\n        padding: 0;\n        line-height: 1;\n      }\n\n      .notific-message-list {\n        flex: 1;\n        overflow-y: auto;\n        padding: 16px;\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n      }\n\n      .notific-message {\n        max-width: 80%;\n        padding: 10px 14px;\n        border-radius: 16px;\n        position: relative;\n        word-wrap: break-word;\n      }\n\n      .notific-message-user {\n        align-self: flex-end;\n        background-color: ").concat(n,";\n        color: white;\n        border-bottom-right-radius: 4px;\n      }\n\n      .notific-message-assistant {\n        align-self: flex-start;\n        background-color: #f0f0f0;\n        color: ").concat(r,";\n        border-bottom-left-radius: 4px;\n      }\n\n      .notific-message-system {\n        align-self: center;\n        background-color: #f8f8f8;\n        color: #666;\n        border-radius: 8px;\n        font-style: italic;\n        max-width: 90%;\n      }\n\n      .notific-input-area {\n        padding: 12px;\n        border-top: 1px solid #eee;\n        display: flex;\n        align-items: center;\n        gap: 10px;\n      }\n\n      .notific-input-field {\n        flex: 1;\n        resize: none;\n        height: 40px;\n        max-height: 120px;\n        padding: 10px 14px;\n        border: 1px solid #ddd;\n        border-radius: 20px;\n        font-family: inherit;\n        font-size: 14px;\n        outline: none;\n      }\n\n      .notific-input-field:focus {\n        border-color: ").concat(n,";\n      }\n\n      .notific-send-button {\n        width: 40px;\n        height: 40px;\n        border-radius: 50%;\n        background-color: ").concat(n,";\n        color: white;\n        border: none;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .notific-send-button:disabled {\n        background-color: #ccc;\n        cursor: not-allowed;\n      }\n\n      @media (max-width: 480px) {\n        .notific-chat-container {\n          width: 280px;\n          height: 350px;\n        }\n      }\n    ")+(this.options.customCSS||""),s=document.createElement("style");s.id="notific-chat-widget-styles",s.textContent=a,document.head.appendChild(s)}},{key:"attachEventListeners",value:function(){var t=this;if(this.container){var e=this.container.querySelector(".notific-toggle-button");e&&e.addEventListener("click",(function(){return t.toggle()}));var n=this.container.querySelector(".notific-close-button");n&&n.addEventListener("click",(function(){return t.hide()}));var i=this.container.querySelector(".notific-send-button");i&&this.inputField&&i.addEventListener("click",(function(){return t.handleSendMessage()})),this.inputField&&(this.inputField.addEventListener("keypress",(function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),t.handleSendMessage())})),this.inputField.addEventListener("input",(function(){t.inputField.style.height="auto",t.inputField.style.height=Math.min(t.inputField.scrollHeight,120)+"px"})))}}},{key:"handleSendMessage",value:function(){if(this.inputField){var t=this.inputField.value.trim();t&&(this.inputField.value="",this.inputField.style.height="auto",this.addMessage({id:"user-".concat(Date.now()),role:"user",content:t,timestamp:Date.now()}),this.onSendMessage(t))}}},{key:"mergeWithDefaultOptions",value:function(t){var e,n,i;return{position:t.position||"right",theme:{primaryColor:(null===(e=t.theme)||void 0===e?void 0:e.primaryColor)||"#0088ff",textColor:(null===(n=t.theme)||void 0===n?void 0:n.textColor)||"#333",fontFamily:(null===(i=t.theme)||void 0===i?void 0:i.fontFamily)||"system-ui, -apple-system, BlinkMacSystemFont, sans-serif"},placeholder:t.placeholder||"Type your message...",greeting:t.greeting||"Hello! How can I help you today?",customCSS:t.customCSS||""}}}])}();function v(){return"".concat(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"notific","-").concat(Date.now(),"-").concat(Math.random().toString(36).substring(2,9))}function y(t,e){if(t){for(var n,i=arguments.length,r=new Array(i>2?i-2:0),o=2;o<i;o++)r[o-2]=arguments[o];(n=console).log.apply(n,["[NotificAI] ".concat(e)].concat(r))}}var b=function(){return a((function t(e){r(this,t),this.actionMapBuilder=null,this.actionExecutor=null,this.apiClient=null,this.chatWidget=null,this.messages=[],this.initialized=!1,this.config=u({apiKey:"",endpoint:"https://api.notific.ai/v1",debug:!1,chatWidget:{enable:!0,position:"right"}},e),t._instance=this}),[{key:"init",value:function(t){var e,n=this;if(this.initialized)return y(this.config.debug||!1,"SDK already initialized"),this;if(t&&(this.config=u(u({},this.config),t)),!this.config.apiKey)throw new Error("API key is required");y(this.config.debug||!1,"Initializing SDK",this.config),this.actionMapBuilder=new f,this.actionMapBuilder.init();var i=this.actionMapBuilder.getActionMap();if(this.actionExecutor=new p(i),this.apiClient=new g(this.config.apiKey,this.config.endpoint),null===(e=this.config.chatWidget)||void 0===e?void 0:e.enable){var r={position:this.config.chatWidget.position||"right",customCSS:this.config.chatWidget.customCSS};this.chatWidget=new m((function(t){return n.handleUserMessage(t)}),r),this.chatWidget.init()}return this.initialized=!0,this}},{key:"show",value:function(){this.initialized||this.init(),this.chatWidget&&this.chatWidget.show()}},{key:"hide",value:function(){this.chatWidget&&this.chatWidget.hide()}},{key:"destroy",value:function(){this.actionMapBuilder&&(this.actionMapBuilder.destroy(),this.actionMapBuilder=null),this.chatWidget&&(this.chatWidget.destroy(),this.chatWidget=null),this.actionExecutor=null,this.apiClient=null,this.messages=[],this.initialized=!1,y(this.config.debug||!1,"SDK destroyed")}},{key:"sendMessage",value:(e=i(d().mark((function t(e){return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.initialized||this.init(),t.next=3,this.handleUserMessage(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"handleUserMessage",value:(t=i(d().mark((function t(e){var n,i,r,o,a,s;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.actionMapBuilder&&this.actionExecutor&&this.apiClient){t.next=2;break}throw new Error("SDK not initialized properly");case 2:return n={id:v("user"),role:"user",content:e,timestamp:Date.now()},this.messages.push(n),i={id:v("loading"),role:"assistant",content:"...",timestamp:Date.now()},this.messages.push(i),this.chatWidget&&this.chatWidget.updateMessages(this.messages),t.prev=7,r=this.actionMapBuilder.getActionMap(),this.actionExecutor.updateActionMap(r),o={url:window.location.href,title:document.title,path:window.location.pathname,referrer:document.referrer||window.location.origin,userAgent:navigator.userAgent,screenWidth:window.screen.width,screenHeight:window.screen.height,viewportWidth:window.innerWidth,viewportHeight:window.innerHeight,timestamp:Date.now()},t.next=13,this.apiClient.sendMessage(e,r,o);case 13:return a=t.sent,this.messages=this.messages.filter((function(t){return t.id!==i.id})),a.response&&a.response.message&&this.messages.push(a.response.message),this.chatWidget&&this.chatWidget.updateMessages(this.messages),a.response&&a.response.actions&&a.response.actions.length>0&&(y(this.config.debug||!1,"Executing actions",a.response.actions),this.actionExecutor.executeActions(a.response.actions)),t.abrupt("return",a);case 21:throw t.prev=21,t.t0=t.catch(7),this.messages=this.messages.filter((function(t){return t.id!==i.id})),s={id:v("error"),role:"system",content:"Sorry, there was an error processing your request.",timestamp:Date.now()},this.messages.push(s),this.chatWidget&&this.chatWidget.updateMessages(this.messages),console.error("Error handling user message:",t.t0),t.t0;case 29:case"end":return t.stop()}}),t,this,[[7,21]])}))),function(e){return t.apply(this,arguments)})},{key:"getMessages",value:function(){return this.messages}},{key:"getActionMap",value:function(){return this.actionMapBuilder?this.actionMapBuilder.getActionMap():null}}]);var t,e}();b._instance=null,"undefined"!=typeof document&&document.addEventListener("DOMContentLoaded",(function(){var t=document.querySelector("script[data-api-key]");if(t){var e=t.getAttribute("data-api-key");if(e){var n=t.getAttribute("data-position"),i=t.hasAttribute("data-debug"),r=new b({apiKey:e,debug:i,chatWidget:{enable:!0,position:n||"right"}});r.init(),window.NotificAI=r}}}));var w=b;t.NotificAI=w,t.default=b,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=notific-ai-sdk.umd.js.map
