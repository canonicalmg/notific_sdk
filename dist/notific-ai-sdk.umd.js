!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).NotificAI={})}(this,(function(t){"use strict";function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function n(t,e,n,i,a,r,o){try{var s=t[r](o),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(i,a)}function i(t){return function(){var e=this,i=arguments;return new Promise((function(a,r){var o=t.apply(e,i);function s(t){n(o,a,r,s,c,"next",t)}function c(t){n(o,a,r,s,c,"throw",t)}s(void 0)}))}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,h(i.key),i)}}function o(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t,n){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,n){if(t){if("string"==typeof t)return e(t,n);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?e(t,n):void 0}}(t))||n&&t&&"number"==typeof t.length){i&&(t=i);var a=0,r=function(){};return{s:r,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){c=!0,o=t},f:function(){try{s||null==i.return||i.return()}finally{if(c)throw o}}}}function c(t,e,n){return(e=h(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function u(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){c(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function d(){d=function(){return e};var t,e={},n=Object.prototype,i=n.hasOwnProperty,a=Object.defineProperty||function(t,e,n){t[e]=n.value},r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",s=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function l(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,n){return t[e]=n}}function u(t,e,n,i){var r=e&&e.prototype instanceof b?e:b,o=Object.create(r.prototype),s=new O(i||[]);return a(o,"_invoke",{value:S(t,n,s)}),o}function h(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var f="suspendedStart",p="suspendedYield",g="executing",m="completed",v={};function b(){}function y(){}function w(){}var x={};l(x,o,(function(){return this}));var k=Object.getPrototypeOf,E=k&&k(k(T([])));E&&E!==n&&i.call(E,o)&&(x=E);var A=w.prototype=b.prototype=Object.create(x);function C(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function M(t,e){function n(a,r,o,s){var c=h(t[a],t,r);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==typeof u&&i.call(u,"__await")?e.resolve(u.__await).then((function(t){n("next",t,o,s)}),(function(t){n("throw",t,o,s)})):e.resolve(u).then((function(t){l.value=t,o(l)}),(function(t){return n("throw",t,o,s)}))}s(c.arg)}var r;a(this,"_invoke",{value:function(t,i){function a(){return new e((function(e,a){n(t,i,e,a)}))}return r=r?r.then(a,a):a()}})}function S(e,n,i){var a=f;return function(r,o){if(a===g)throw Error("Generator is already running");if(a===m){if("throw"===r)throw o;return{value:t,done:!0}}for(i.method=r,i.arg=o;;){var s=i.delegate;if(s){var c=L(s,i);if(c){if(c===v)continue;return c}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(a===f)throw a=m,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);a=g;var l=h(e,n,i);if("normal"===l.type){if(a=i.done?m:p,l.arg===v)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(a=m,i.method="throw",i.arg=l.arg)}}}function L(e,n){var i=n.method,a=e.iterator[i];if(a===t)return n.delegate=null,"throw"===i&&e.iterator.return&&(n.method="return",n.arg=t,L(e,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),v;var r=h(a,e.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,v;var o=r.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,v):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function I(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function F(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(I,this),this.reset(!0)}function T(e){if(e||""===e){var n=e[o];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,r=function n(){for(;++a<e.length;)if(i.call(e,a))return n.value=e[a],n.done=!1,n;return n.value=t,n.done=!0,n};return r.next=r}}throw new TypeError(typeof e+" is not iterable")}return y.prototype=w,a(A,"constructor",{value:w,configurable:!0}),a(w,"constructor",{value:y,configurable:!0}),y.displayName=l(w,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,l(t,c,"GeneratorFunction")),t.prototype=Object.create(A),t},e.awrap=function(t){return{__await:t}},C(M.prototype),l(M.prototype,s,(function(){return this})),e.AsyncIterator=M,e.async=function(t,n,i,a,r){void 0===r&&(r=Promise);var o=new M(u(t,n,i,a),r);return e.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},C(A),l(A,c,"Generator"),l(A,o,(function(){return this})),l(A,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var i in e)n.push(i);return n.reverse(),function t(){for(;n.length;){var i=n.pop();if(i in e)return t.value=i,t.done=!1,t}return t.done=!0,t}},e.values=T,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(F),!e)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function a(i,a){return s.type="throw",s.arg=e,n.next=i,a&&(n.method="next",n.arg=t),!!a}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],s=o.completion;if("root"===o.tryLoc)return a("end");if(o.tryLoc<=this.prev){var c=i.call(o,"catchLoc"),l=i.call(o,"finallyLoc");if(c&&l){if(this.prev<o.catchLoc)return a(o.catchLoc,!0);if(this.prev<o.finallyLoc)return a(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return a(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return a(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&i.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var r=a;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var o=r?r.completion:{};return o.type=t,o.arg=e,r?(this.method="next",this.next=r.finallyLoc,v):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),F(n),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var a=i.arg;F(n)}return a}}throw Error("illegal catch attempt")},delegateYield:function(e,n,i){return this.delegate={iterator:T(e),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=t),v}},e}function h(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}var f=function(){return o((function t(){a(this,t),this.observer=null,this.actionCatalog={},this.actionMap=this.createEmptyActionMap()}),[{key:"init",value:function(){this.buildActionMap(),this.buildActionCatalog(),this.observeDOM()}},{key:"destroy",value:function(){this.observer&&(this.observer.disconnect(),this.observer=null)}},{key:"getActionMap",value:function(){return this.actionMap.timestamp=Date.now(),this.actionMap}},{key:"createEmptyActionMap",value:function(){return{url:window.location.href,title:document.title,elements:[],actionCatalog:{},timestamp:Date.now()}}},{key:"buildActionCatalog",value:function(){var t=this;this.actionCatalog={};var e=document.querySelectorAll("[data-ai-provides-access]");console.log("Found ".concat(e.length," navigation elements with data-ai-provides-access"));var n=document.querySelectorAll('[data-ai-action="switch_tab"]');if(console.log("Found ".concat(n.length," tab navigation elements")),n.length>0){var i={};n.forEach((function(t){var e=t.getAttribute("data-ai-action-param"),n=t.getAttribute("data-ai-provides-access");e&&n&&(i[e]=n.split(",").map((function(t){return t.trim()})),console.log('Tab "'.concat(e,'" provides access to: ').concat(i[e].join(", "))))})),i.workflows&&i.workflows.includes("create_workflow")&&(this.actionCatalog.create_workflow={navigationSteps:[{action:"switch_tab",param:"workflows"}]},console.log("Added explicit navigation for create_workflow action"))}e.forEach((function(e){var n=e.getAttribute("data-ai-provides-access");if(n){var i=n.split(",").map((function(t){return t.trim()})),a=e.getAttribute("data-ai-action"),r=e.getAttribute("data-ai-action-param");if(a){var o={action:a};r&&(o.param=r),i.forEach((function(e){e.trim()&&(t.actionCatalog[e]?(console.log("Multiple paths found for action: ".concat(e)),t.actionCatalog[e].navigationSteps.length>1&&(t.actionCatalog[e]={navigationSteps:[o]})):(t.actionCatalog[e]={navigationSteps:[o]},console.log("Added catalog entry for action: ".concat(e))))}))}}})),document.querySelectorAll('[data-ai-action="switch_tab"]').forEach((function(e){var n=e.getAttribute("data-ai-action-param");if(n){var i="navigate_to_".concat(n);t.actionCatalog[i]={navigationSteps:[{action:"switch_tab",param:n}]},console.log("Added explicit tab navigation entry for: ".concat(i))}})),console.log("Action catalog built:",this.actionCatalog),console.log("Total action catalog entries: ".concat(Object.keys(this.actionCatalog).length)),this.actionMap.actionCatalog=this.actionCatalog}},{key:"buildActionMap",value:function(){var t=this;this.actionMap=this.createEmptyActionMap();var e=document.querySelectorAll("[data-ai-field]"),n=document.querySelectorAll("[data-ai-action]");e.forEach((function(e){var n=t.processFieldElement(e);n&&t.actionMap.elements.push(n)})),n.forEach((function(e){var n=t.processActionElement(e);n&&t.actionMap.elements.push(n)}))}},{key:"processFieldElement",value:function(t){var e=t.getAttribute("data-ai-field");if(!e)return null;var n,i,a=t.getBoundingClientRect(),r=t.tagName.toLowerCase();if("input"===r||"textarea"===r)n=t.value;else if("select"===r){var o=t;n=o.value,i=Array.from(o.options).map((function(t){return t.text}))}var s=this.findLabelForElement(t),c=this.getDomPath(t);return{id:this.generateElementId(t),type:"field",name:e,value:n,position:{x:a.left+window.scrollX,y:a.top+window.scrollY},elementType:r,label:s,options:i,required:t.hasAttribute("required"),disabled:t.hasAttribute("disabled"),path:c}}},{key:"processActionElement",value:function(t){var e,n=t.getAttribute("data-ai-action");if(!n)return null;var i=t.getBoundingClientRect(),a=t.tagName.toLowerCase(),r=(null===(e=t.textContent)||void 0===e?void 0:e.trim())||void 0;if(!r||""===r){var o=t.getAttribute("aria-label");o&&(r=o)}var s=this.getDomPath(t),c=t.getAttribute("data-ai-provides-access"),l=t.getAttribute("data-ai-action-param"),u={id:this.generateElementId(t),type:"action",name:n,position:{x:i.left+window.scrollX,y:i.top+window.scrollY},elementType:a,label:r,disabled:t.hasAttribute("disabled"),path:s};return c&&(u.providesAccess=c.split(",").map((function(t){return t.trim()}))),l&&(u.accessParam=l),u}},{key:"findLabelForElement",value:function(t){if(t.id){var e=document.querySelector('label[for="'.concat(t.id,'"]'));if(e&&e.textContent)return e.textContent.trim()}for(var n=t.parentElement;n;){if("label"===n.tagName.toLowerCase()&&n.textContent)return n.textContent.trim();n=n.parentElement}var i=t.getAttribute("aria-label");if(i)return i;var a=t.getAttribute("placeholder");return a||void 0}},{key:"generateElementId",value:function(t){if(t.id)return t.id;var e=t.getAttribute("data-ai-field")?"field":t.getAttribute("data-ai-action")?"action":"element",n=t.getAttribute("data-ai-field")||t.getAttribute("data-ai-action")||t.tagName.toLowerCase(),i=Math.random().toString(36).substring(2,8);return"notific-".concat(e,"-").concat(n,"-").concat(i)}},{key:"getDomPath",value:function(t){for(var e=[],n=t;n;){var i=n.tagName.toLowerCase();if(n.id)i+="#".concat(n.id);else if(n.className&&"string"==typeof n.className){var a=n.className.split(/\s+/).filter(Boolean);a.length&&(i+=".".concat(a.join(".")))}e.unshift(i),n=n.parentElement}return e}},{key:"observeDOM",value:function(){var t=this;this.observer=new MutationObserver((function(e){var n,i=!1,a=s(e);try{for(a.s();!(n=a.n()).done;){var r=n.value;if("childList"===r.type){for(var o=0,c=Array.from(r.addedNodes);o<c.length;o++){var l=c[o];if(l instanceof HTMLElement&&(l.hasAttribute("data-ai-field")||l.hasAttribute("data-ai-action")||l.querySelector("[data-ai-field], [data-ai-action]"))){i=!0;break}}for(var u=0,d=Array.from(r.removedNodes);u<d.length;u++){var h=d[u];if(h instanceof HTMLElement&&(h.hasAttribute("data-ai-field")||h.hasAttribute("data-ai-action")||h.querySelector("[data-ai-field], [data-ai-action]"))){i=!0;break}}}else if("attributes"===r.type){var f=r.target;if("data-ai-field"===r.attributeName||"data-ai-action"===r.attributeName||f.hasAttribute("data-ai-field")||f.hasAttribute("data-ai-action")){i=!0;break}}if(i)break}}catch(t){a.e(t)}finally{a.f()}i&&t.buildActionMap()})),this.observer.observe(document.documentElement,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["data-ai-field","data-ai-action","value","disabled"]})}}])}(),p=function(){return o((function t(e){a(this,t),this.elementCache=new Map,this.actionMap=e}),[{key:"updateActionMap",value:function(t){this.actionMap=t,this.elementCache.clear()}},{key:"checkNavigationSteps",value:function(t){var e=this;if(console.log("Checking navigation steps for action: ".concat(t)),this.actionMap.actionCatalog&&this.actionMap.actionCatalog[t]){var n=this.actionMap.actionCatalog[t];console.log("Found catalog entry with ".concat(n.navigationSteps.length," navigation steps"));var i=n.navigationSteps.map((function(t){if(console.log("Processing navigation step: action=".concat(t.action,", param=").concat(t.param||"none")),"switch_tab"===t.action&&t.param){var n=document.querySelectorAll('[data-ai-action="switch_tab"]'),i=null;console.log("Found ".concat(n.length," tab buttons to check for param ").concat(t.param));for(var a=0,r=Array.from(n);a<r.length;a++){if(r[a].getAttribute("data-ai-action-param")===t.param&&(i=e.actionMap.elements.find((function(e){return"switch_tab"===e.name&&e.accessParam===t.param})))){console.log("Found matching tab element with ID ".concat(i.id));break}}if(i)return{type:"click",elementId:i.id};if("workflows"===t.param){console.log("🔍 SPECIAL CASE: Looking for workflows tab button in DOM");var o=Array.from(n).find((function(t){var e;return"workflows"===t.getAttribute("data-ai-action-param")||"workflows"===(null===(e=t.textContent)||void 0===e?void 0:e.trim().toLowerCase())}));return o?(console.log("✅ Found workflows tab button directly in DOM"),{type:"click",elementId:"tab-workflows-direct",options:{param:"workflows",directElement:o,buttonIndex:2}}):(console.log("❌ Could not find workflows tab button directly - using index-based fallback"),{type:"click",elementId:"tab-workflows-index-2",options:{param:"workflows",buttonIndex:2}})}console.log("Could not find tab element in action map, using generic ID for tab ".concat(t.param));var s=Math.random().toString(36).substring(2,8);return{type:"click",elementId:"notific-action-switch_tab-".concat(s),options:{param:t.param}}}var c=e.actionMap.elements.find((function(e){return e.name===t.action&&(!t.param||e.accessParam===t.param)}));return c?(console.log("Found element ID ".concat(c.id," for navigation step ").concat(t.action)),{type:"click",elementId:c.id}):(console.error("Cannot find element for navigation step: ".concat(t.action)),null)})).filter(Boolean);return console.log("Generated ".concat(i.length," navigation actions")),i.length>0?i:null}return console.log("No catalog entry found for action: ".concat(t)),null}},{key:"executeActions",value:(u=i(d().mark((function t(e){var n,i,a,r=this;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,n=s(e),t.prev=2,a=d().mark((function t(){var e,n,a,o,c,l;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=i.value,r.findElementById(e.elementId)){t.next=31;break}if(!(n=r.actionMap.elements.find((function(t){return t.id===e.elementId})))||!n.name){t.next=31;break}if(!(a=r.checkNavigationSteps(n.name))){t.next=31;break}console.log("Element ".concat(n.name," requires navigation steps")),o=s(a),t.prev=9,o.s();case 11:if((c=o.n()).done){t.next=19;break}return l=c.value,t.next=15,r.executeAction(l);case 15:return t.next=17,r.delay(500);case 17:t.next=11;break;case 19:t.next=24;break;case 21:t.prev=21,t.t0=t.catch(9),o.e(t.t0);case 24:return t.prev=24,o.f(),t.finish(24);case 27:if(r.findElementById(e.elementId)){t.next=31;break}return console.error("Element still not found after navigation: ".concat(e.elementId)),t.abrupt("return",1);case 31:return t.next=33,r.executeAction(e);case 33:return t.next=35,r.delay(300);case 35:case"end":return t.stop()}}),t,null,[[9,21,24,27]])})),n.s();case 5:if((i=n.n()).done){t.next=11;break}return t.delegateYield(a(),"t0",7);case 7:if(!t.t0){t.next=9;break}return t.abrupt("continue",9);case 9:t.next=5;break;case 11:t.next=16;break;case 13:t.prev=13,t.t1=t.catch(2),n.e(t.t1);case 16:return t.prev=16,n.f(),t.finish(16);case 19:return t.abrupt("return",!0);case 22:return t.prev=22,t.t2=t.catch(0),console.error("Error executing actions:",t.t2),t.abrupt("return",!1);case 26:case"end":return t.stop()}}),t,null,[[0,22],[2,13,16,19]])}))),function(t){return u.apply(this,arguments)})},{key:"executeAction",value:(l=i(d().mark((function t(e){var n,i,a,r,o,s,c,l,u,h,f,p,g,m,v,b,y;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((a=this.findElementById(e.elementId))||!e.elementId.includes("switch_tab")){t.next=53;break}if(r=null,!e.options||!e.options.directElement){t.next=8;break}console.log("Using direct element reference for tab switching"),a=e.options.directElement,t.next=53;break;case 8:if(!e.options||"number"!=typeof e.options.buttonIndex){t.next=15;break}o=document.querySelectorAll('[data-ai-action="switch_tab"]'),s=Array.from(o),c=e.options.buttonIndex,s.length>c&&(console.log("Using tab button at index ".concat(c)),a=s[c]),t.next=53;break;case 15:if(e.options&&e.options.param?r=e.options.param:e.elementId.includes("-workflows")?r="workflows":e.elementId.includes("-dashboard")?r="dashboard":e.elementId.includes("-integrations")?r="integrations":e.elementId.includes("-billing")?r="billing":e.elementId.includes("-settings")&&(r="settings"),console.log("Looking for tab button with param: ".concat(r||"unknown")),l=document.querySelectorAll('[data-ai-action="switch_tab"]'),console.log("Found ".concat(l.length," tab buttons")),!r){t.next=37;break}u=0,h=Array.from(l);case 21:if(!(u<h.length)){t.next=37;break}if(f=h[u],p=f.getAttribute("data-ai-action-param"),console.log("Checking button with param: ".concat(p)),p!==r){t.next=29;break}return console.log("Found tab button for ".concat(r," via specific match")),a=f,t.abrupt("break",37);case 29:if((null===(n=f.textContent)||void 0===n?void 0:n.trim().toLowerCase())!==r.toLowerCase()){t.next=34;break}return console.log("Found tab button for ".concat(r," via text content")),a=f,t.abrupt("break",37);case 34:u++,t.next=21;break;case 37:if(a||"workflows"!==r||(console.log("WORKFLOWS TAB SPECIAL CASE: Finding button by index (2)"),(g=Array.from(l)).length>=3&&(a=g[2],console.log("Using workflows tab button by index"))),a||"workflows"!==r){t.next=52;break}console.log("TRYING EXACT TEXT MATCH for workflows tab"),m=Array.from(l),v=0,b=m;case 42:if(!(v<b.length)){t.next=52;break}if(y=b[v],"workflows"!==(null===(i=y.textContent)||void 0===i?void 0:i.trim().toLowerCase())){t.next=49;break}return a=y,console.log("Found workflows tab by exact text match"),t.abrupt("break",52);case 49:v++,t.next=42;break;case 52:!a&&l.length>0&&(console.log("No specific tab button found, using first available tab button"),a=l[0]);case 53:if(a){t.next=55;break}throw new Error("Element with ID ".concat(e.elementId," not found"));case 55:this.highlightElement(a),t.t0=e.type,t.next="fill"===t.t0?59:"click"===t.t0?62:"select"===t.t0?65:"scroll"===t.t0?68:"custom"===t.t0?71:74;break;case 59:return t.next=61,this.fillField(a,e.value||"");case 61:return t.abrupt("break",75);case 62:return t.next=64,this.clickElement(a);case 64:return t.abrupt("break",75);case 65:return t.next=67,this.selectOption(a,e.value||"");case 67:return t.abrupt("break",75);case 68:return t.next=70,this.scrollToElement(a);case 70:return t.abrupt("break",75);case 71:return t.next=73,this.executeCustomAction(a,e.options);case 73:return t.abrupt("break",75);case 74:throw new Error("Unknown action type: ".concat(e.type));case 75:case"end":return t.stop()}}),t,this)}))),function(t){return l.apply(this,arguments)})},{key:"findElementById",value:function(t){if(this.elementCache.has(t))return this.elementCache.get(t)||null;var e=this.actionMap.elements.find((function(e){return e.id===t})),n=document.getElementById(t);if(!n&&e&&e.path&&e.path.length>0)try{var i=e.path.map((function(t){var e=t.match(/^([a-zA-Z0-9-]+)/),n=t.match(/#([a-zA-Z0-9-]+)/),i=t.match(/\.([a-zA-Z0-9_-][^\s.]*)/g),a=e?e[1]:"";return n&&(a+="#".concat(n[1])),i&&i.forEach((function(t){var e=t.substring(1).replace(/([:\\.!@#$%^&*()+=])/g,"\\$1");a+=".".concat(e)})),a})).join(" > ");console.log("Using selector:",i);var a=document.querySelectorAll(i);if(1===a.length)n=a[0];else if(a.length>1)for(var r=0,o=Array.from(a);r<o.length;r++){var s=o[r];if("field"===e.type&&s.getAttribute("data-ai-field")===e.name){n=s;break}if("action"===e.type&&s.getAttribute("data-ai-action")===e.name){n=s;break}}}catch(t){console.error("Error finding element by path:",t)}if(!n)if(t.startsWith("notific-action-")){var c=t.match(/notific-action-([^-]+)/);if(c&&c[1]){var l=c[1];if(console.log("Trying fallback for action: ".concat(l)),"switch_tab"===l){var u=document.querySelectorAll('[data-ai-action="switch_tab"]');if(u.length>0){if(e&&e.accessParam)for(var d=0,h=Array.from(u);d<h.length;d++){var f=h[d];if(f.getAttribute("data-ai-action-param")===e.accessParam){n=f,console.log("Fallback: Found tab button for ".concat(e.accessParam));break}}n||(n=u[0],console.log("Fallback: Found tab button (first one)"))}}else{var p=document.querySelectorAll('[data-ai-action="'.concat(l,'"]'));if(p.length>0)n=p[0],console.log("Fallback: Found ".concat(l," button by data-ai-action"));else if(l.includes("clear")){var g=document.querySelectorAll('[data-ai-action="clear_form"]');g.length>0&&(n=g[0],console.log("Fallback: Found clear button by data-ai-action"))}else{var m=document.querySelectorAll('[data-ai-action="submit_form"]');m.length>0&&(n=m[0],console.log("Fallback: Found submit button by data-ai-action"))}}}}else if(t.startsWith("action-")){if(t.includes("clear")){var v=document.querySelectorAll('[data-ai-action="clear_form"]');v.length>0&&(n=v[0],console.log("Fallback: Found clear button by data-ai-action"))}else{var b=document.querySelectorAll('[data-ai-action="submit_form"]');b.length>0&&(n=b[0],console.log("Fallback: Found submit button by data-ai-action"))}}return n&&this.elementCache.set(t,n),n}},{key:"highlightElement",value:function(t){var e=t.style.outline,n=t.style.transition;t.style.outline="2px solid #0088ff",t.style.transition="outline 0.2s ease-in-out",setTimeout((function(){t.style.outline=e,t.style.transition=n}),1e3)}},{key:"fillField",value:(c=i(d().mark((function t(e,n){var i,a,r,o;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement)){t.next=19;break}e.value="",e.focus(),i=0;case 4:if(!(i<n.length)){t.next=14;break}return a=n.charAt(i),e.value+=a,r=new Event("input",{bubbles:!0}),e.dispatchEvent(r),t.next=11,this.delay(50);case 11:i++,t.next=4;break;case 14:o=new Event("change",{bubbles:!0}),e.dispatchEvent(o),e.blur(),t.next=20;break;case 19:throw new Error("Element is not an input field");case 20:case"end":return t.stop()}}),t,this)}))),function(t,e){return c.apply(this,arguments)})},{key:"clickElement",value:(r=i(d().mark((function t(e){var n,i,a;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.scrollToElement(e);case 2:return n=new MouseEvent("mousedown",{bubbles:!0,cancelable:!0,view:window}),e.dispatchEvent(n),t.next=6,this.delay(50);case 6:i=new MouseEvent("mouseup",{bubbles:!0,cancelable:!0,view:window}),e.dispatchEvent(i),a=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window}),e.dispatchEvent(a);case 10:case"end":return t.stop()}}),t,this)}))),function(t){return r.apply(this,arguments)})},{key:"selectOption",value:(n=i(d().mark((function t(e,n){var i,a,r,o,s;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e instanceof HTMLSelectElement)){t.next=18;break}i=!1,a=0,r=Array.from(e.options);case 3:if(!(a<r.length)){t.next=12;break}if((o=r[a]).value!==n&&o.text!==n){t.next=9;break}return e.value=o.value,i=!0,t.abrupt("break",12);case 9:a++,t.next=3;break;case 12:if(i){t.next=14;break}throw new Error('Option with value or text "'.concat(n,'" not found in select element'));case 14:s=new Event("change",{bubbles:!0}),e.dispatchEvent(s),t.next=19;break;case 18:throw new Error("Element is not a select element");case 19:case"end":return t.stop()}}),t)}))),function(t,e){return n.apply(this,arguments)})},{key:"scrollToElement",value:(e=i(d().mark((function t(e){var n;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((n=e.getBoundingClientRect()).top>=0&&n.left>=0&&n.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&n.right<=(window.innerWidth||document.documentElement.clientWidth)){t.next=6;break}return e.scrollIntoView({behavior:"smooth",block:"center"}),t.next=6,this.delay(500);case 6:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"executeCustomAction",value:(t=i(d().mark((function t(e,n){var i,a,r;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n||!n.type){t.next=14;break}t.t0=n.type,t.next="hover"===t.t0?4:"focus"===t.t0?7:"blur"===t.t0?9:"setValue"===t.t0?11:13;break;case 4:return i=new MouseEvent("mouseover",{bubbles:!0,cancelable:!0,view:window}),e.dispatchEvent(i),t.abrupt("break",14);case 7:return e.focus(),t.abrupt("break",14);case 9:return e.blur(),t.abrupt("break",14);case 11:return(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement)&&(e.value=n.value||"",a=new Event("input",{bubbles:!0}),e.dispatchEvent(a),r=new Event("change",{bubbles:!0}),e.dispatchEvent(r)),t.abrupt("break",14);case 13:throw new Error("Unknown custom action type: ".concat(n.type));case 14:case"end":return t.stop()}}),t)}))),function(e,n){return t.apply(this,arguments)})},{key:"delay",value:function(t){return new Promise((function(e){return setTimeout(e,t)}))}}]);var t,e,n,r,c,l,u}(),g=function(){return o((function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"https://api.notific.ai/v1";a(this,t),this.sessionId=null,this.apiKey=e,this.endpoint=n.endsWith("/")?n.slice(0,-1):n}),[{key:"sendMessage",value:(n=i(d().mark((function t(e,n){var i,a,r,o,s,c=arguments;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=c.length>2&&void 0!==c[2]?c[2]:{},a="".concat(this.endpoint,"/api/interactive/process"),r=u(u({message:e,actionMap:n},this.sessionId?{sessionId:this.sessionId}:{}),{},{pageContext:i}),t.prev=3,t.next=6,fetch(a,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.apiKey)},body:JSON.stringify(r),mode:"cors",credentials:"include"});case 6:if((o=t.sent).ok){t.next=9;break}throw new Error("API request failed with status ".concat(o.status));case 9:return t.next=11,o.json();case 11:return(s=t.sent).sessionId&&(this.sessionId=s.sessionId),t.abrupt("return",s);case 16:return t.prev=16,t.t0=t.catch(3),console.error("Error sending message to API:",t.t0),t.abrupt("return",{response:{actions:[],message:{id:"error-".concat(Date.now()),role:"assistant",content:"Sorry, I encountered an error processing your request. Please try again later.",timestamp:Date.now()}},sessionId:this.sessionId||"fallback-".concat(Date.now())});case 20:case"end":return t.stop()}}),t,this,[[3,16]])}))),function(t,e){return n.apply(this,arguments)})},{key:"sendFeedback",value:(e=i(d().mark((function t(e,n,i){var a,r;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.sessionId){t.next=2;break}return t.abrupt("return",!1);case 2:return a="".concat(this.endpoint,"/api/interactive/feedback"),t.prev=3,t.next=6,fetch(a,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.apiKey)},body:JSON.stringify({sessionId:this.sessionId,messageId:e,feedback:n,comment:i}),mode:"cors",credentials:"include"});case 6:return r=t.sent,t.abrupt("return",r.ok);case 10:return t.prev=10,t.t0=t.catch(3),console.error("Error sending feedback:",t.t0),t.abrupt("return",!1);case 14:case"end":return t.stop()}}),t,this,[[3,10]])}))),function(t,n,i){return e.apply(this,arguments)})},{key:"getConversationHistory",value:(t=i(d().mark((function t(){var e,n,i;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.sessionId){t.next=2;break}return t.abrupt("return",[]);case 2:return e="".concat(this.endpoint,"/api/interactive/conversation/").concat(this.sessionId),t.prev=3,t.next=6,fetch(e,{method:"GET",headers:{Authorization:"Bearer ".concat(this.apiKey)},mode:"cors",credentials:"include"});case 6:if((n=t.sent).ok){t.next=9;break}throw new Error("API request failed with status ".concat(n.status));case 9:return t.next=11,n.json();case 11:return i=t.sent,t.abrupt("return",i.messages||[]);case 15:return t.prev=15,t.t0=t.catch(3),console.error("Error fetching conversation history:",t.t0),t.abrupt("return",[]);case 19:case"end":return t.stop()}}),t,this,[[3,15]])}))),function(){return t.apply(this,arguments)})}]);var t,e,n}(),m=function(){return o((function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{position:"right"};a(this,t),this.container=null,this.messageList=null,this.inputField=null,this.isOpen=!1,this.onSendMessage=e,this.options=this.mergeWithDefaultOptions(n)}),[{key:"init",value:function(){this.createWidgetDOM(),this.attachEventListeners()}},{key:"show",value:function(){var t=this;this.container&&(this.container.style.display="block",setTimeout((function(){t.container&&t.container.classList.add("notific-widget-visible")}),10),this.isOpen=!0)}},{key:"hide",value:function(){var t=this;this.container&&(this.container.classList.remove("notific-widget-visible"),setTimeout((function(){t.container&&(t.container.style.display="none")}),300),this.isOpen=!1)}},{key:"toggle",value:function(){this.isOpen?this.hide():this.show()}},{key:"addMessage",value:function(t){if(this.messageList){var e=document.createElement("div");e.className="notific-message notific-message-".concat(t.role),e.setAttribute("data-message-id",t.id);var n=document.createElement("div");n.className="notific-message-content",n.textContent=t.content,e.appendChild(n),this.messageList.appendChild(e),this.messageList.scrollTop=this.messageList.scrollHeight}}},{key:"updateMessages",value:function(t){if(this.messageList){this.messageList.innerHTML="";var e,n=s(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;this.addMessage(i)}}catch(t){n.e(t)}finally{n.f()}}}},{key:"destroy",value:function(){this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container);var t=document.getElementById("notific-chat-widget-styles");t&&t.parentNode&&t.parentNode.removeChild(t)}},{key:"createWidgetDOM",value:function(){this.addStyles(),this.container=document.createElement("div"),this.container.className="notific-chat-widget",this.container.classList.add("notific-position-".concat(this.options.position));var t=document.createElement("button");t.className="notific-toggle-button",t.setAttribute("aria-label","Toggle chat assistant"),t.innerHTML='\n      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>\n      </svg>\n    ';var e=document.createElement("div");e.className="notific-chat-container";var n=document.createElement("div");n.className="notific-chat-header";var i=document.createElement("div");i.className="notific-header-title",i.textContent="AI Assistant";var a=document.createElement("button");a.className="notific-close-button",a.setAttribute("aria-label","Close chat"),a.innerHTML="&times;",n.appendChild(i),n.appendChild(a),this.messageList=document.createElement("div"),this.messageList.className="notific-message-list";var r=document.createElement("div");r.className="notific-input-area",this.inputField=document.createElement("textarea"),this.inputField.className="notific-input-field",this.inputField.placeholder=this.options.placeholder||"Type your message...",this.inputField.rows=1;var o=document.createElement("button");o.className="notific-send-button",o.setAttribute("aria-label","Send message"),o.innerHTML='\n      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n        <line x1="22" y1="2" x2="11" y2="13"></line>\n        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>\n      </svg>\n    ',r.appendChild(this.inputField),r.appendChild(o),e.appendChild(n),e.appendChild(this.messageList),e.appendChild(r),this.container.appendChild(t),this.container.appendChild(e),document.body.appendChild(this.container),this.options.greeting&&this.addMessage({id:"greeting",role:"system",content:this.options.greeting,timestamp:Date.now()})}},{key:"addStyles",value:function(){var t=this.options.theme||{},e=t.primaryColor,n=void 0===e?"#0088ff":e,i=t.textColor,a=void 0===i?"#333":i,r=t.fontFamily,o="\n      .notific-chat-widget {\n        position: fixed;\n        bottom: 20px;\n        z-index: 9999;\n        display: none;\n        font-family: ".concat(void 0===r?"system-ui, -apple-system, BlinkMacSystemFont, sans-serif":r,";\n        transition: opacity 0.3s, transform 0.3s;\n        opacity: 0;\n        transform: translateY(20px);\n      }\n\n      .notific-widget-visible {\n        opacity: 1;\n        transform: translateY(0);\n      }\n\n      .notific-position-right {\n        right: 20px;\n      }\n\n      .notific-position-left {\n        left: 20px;\n      }\n\n      .notific-toggle-button {\n        position: absolute;\n        bottom: 0;\n        right: 0;\n        width: 50px;\n        height: 50px;\n        border-radius: 50%;\n        background-color: ").concat(n,";\n        color: white;\n        border: none;\n        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 2;\n      }\n\n      .notific-chat-container {\n        position: absolute;\n        bottom: 70px;\n        right: 0;\n        width: 320px;\n        height: 400px;\n        border-radius: 12px;\n        background-color: white;\n        box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n      }\n\n      .notific-position-left .notific-chat-container {\n        right: auto;\n        left: 0;\n      }\n\n      .notific-chat-header {\n        padding: 12px 16px;\n        background-color: ").concat(n,";\n        color: white;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n      }\n\n      .notific-header-title {\n        font-weight: bold;\n      }\n\n      .notific-close-button {\n        background: none;\n        border: none;\n        color: white;\n        font-size: 24px;\n        cursor: pointer;\n        padding: 0;\n        line-height: 1;\n      }\n\n      .notific-message-list {\n        flex: 1;\n        overflow-y: auto;\n        padding: 16px;\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n      }\n\n      .notific-message {\n        max-width: 80%;\n        padding: 10px 14px;\n        border-radius: 16px;\n        position: relative;\n        word-wrap: break-word;\n      }\n\n      .notific-message-user {\n        align-self: flex-end;\n        background-color: ").concat(n,";\n        color: white;\n        border-bottom-right-radius: 4px;\n      }\n\n      .notific-message-assistant {\n        align-self: flex-start;\n        background-color: #f0f0f0;\n        color: ").concat(a,";\n        border-bottom-left-radius: 4px;\n      }\n\n      .notific-message-system {\n        align-self: center;\n        background-color: #f8f8f8;\n        color: #666;\n        border-radius: 8px;\n        font-style: italic;\n        max-width: 90%;\n      }\n\n      .notific-input-area {\n        padding: 12px;\n        border-top: 1px solid #eee;\n        display: flex;\n        align-items: center;\n        gap: 10px;\n      }\n\n      .notific-input-field {\n        flex: 1;\n        resize: none;\n        height: 40px;\n        max-height: 120px;\n        padding: 10px 14px;\n        border: 1px solid #ddd;\n        border-radius: 20px;\n        font-family: inherit;\n        font-size: 14px;\n        outline: none;\n      }\n\n      .notific-input-field:focus {\n        border-color: ").concat(n,";\n      }\n\n      .notific-send-button {\n        width: 40px;\n        height: 40px;\n        border-radius: 50%;\n        background-color: ").concat(n,";\n        color: white;\n        border: none;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .notific-send-button:disabled {\n        background-color: #ccc;\n        cursor: not-allowed;\n      }\n\n      @media (max-width: 480px) {\n        .notific-chat-container {\n          width: 280px;\n          height: 350px;\n        }\n      }\n    ")+(this.options.customCSS||""),s=document.createElement("style");s.id="notific-chat-widget-styles",s.textContent=o,document.head.appendChild(s)}},{key:"attachEventListeners",value:function(){var t=this;if(this.container){var e=this.container.querySelector(".notific-toggle-button");e&&e.addEventListener("click",(function(){return t.toggle()}));var n=this.container.querySelector(".notific-close-button");n&&n.addEventListener("click",(function(){return t.hide()}));var i=this.container.querySelector(".notific-send-button");i&&this.inputField&&i.addEventListener("click",(function(){return t.handleSendMessage()})),this.inputField&&(this.inputField.addEventListener("keypress",(function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),t.handleSendMessage())})),this.inputField.addEventListener("input",(function(){t.inputField.style.height="auto",t.inputField.style.height=Math.min(t.inputField.scrollHeight,120)+"px"})))}}},{key:"handleSendMessage",value:function(){if(this.inputField){var t=this.inputField.value.trim();t&&(this.inputField.value="",this.inputField.style.height="auto",this.addMessage({id:"user-".concat(Date.now()),role:"user",content:t,timestamp:Date.now()}),this.onSendMessage(t))}}},{key:"mergeWithDefaultOptions",value:function(t){var e,n,i;return{position:t.position||"right",theme:{primaryColor:(null===(e=t.theme)||void 0===e?void 0:e.primaryColor)||"#0088ff",textColor:(null===(n=t.theme)||void 0===n?void 0:n.textColor)||"#333",fontFamily:(null===(i=t.theme)||void 0===i?void 0:i.fontFamily)||"system-ui, -apple-system, BlinkMacSystemFont, sans-serif"},placeholder:t.placeholder||"Type your message...",greeting:t.greeting||"Hello! How can I help you today?",customCSS:t.customCSS||""}}}])}();function v(){return"".concat(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"notific","-").concat(Date.now(),"-").concat(Math.random().toString(36).substring(2,9))}function b(t,e){if(t){for(var n,i=arguments.length,a=new Array(i>2?i-2:0),r=2;r<i;r++)a[r-2]=arguments[r];(n=console).log.apply(n,["[NotificAI] ".concat(e)].concat(a))}}var y=function(){return o((function t(e){a(this,t),this.actionMapBuilder=null,this.actionExecutor=null,this.apiClient=null,this.chatWidget=null,this.messages=[],this.initialized=!1,this.config=u({apiKey:"",endpoint:"https://api.notific.ai/v1",debug:!1,chatWidget:{enable:!0,position:"right"}},e),t._instance=this}),[{key:"init",value:function(t){var e,n=this;if(this.initialized)return b(this.config.debug||!1,"SDK already initialized"),this;if(t&&(this.config=u(u({},this.config),t)),!this.config.apiKey)throw new Error("API key is required");b(this.config.debug||!1,"Initializing SDK",this.config),this.actionMapBuilder=new f,this.actionMapBuilder.init();var i=this.actionMapBuilder.getActionMap();if(this.actionExecutor=new p(i),this.apiClient=new g(this.config.apiKey,this.config.endpoint),null===(e=this.config.chatWidget)||void 0===e?void 0:e.enable){var a={position:this.config.chatWidget.position||"right",customCSS:this.config.chatWidget.customCSS};this.chatWidget=new m((function(t){return n.handleUserMessage(t)}),a),this.chatWidget.init()}return this.initialized=!0,this}},{key:"show",value:function(){this.initialized||this.init(),this.chatWidget&&this.chatWidget.show()}},{key:"hide",value:function(){this.chatWidget&&this.chatWidget.hide()}},{key:"destroy",value:function(){this.actionMapBuilder&&(this.actionMapBuilder.destroy(),this.actionMapBuilder=null),this.chatWidget&&(this.chatWidget.destroy(),this.chatWidget=null),this.actionExecutor=null,this.apiClient=null,this.messages=[],this.initialized=!1,b(this.config.debug||!1,"SDK destroyed")}},{key:"sendMessage",value:(e=i(d().mark((function t(e){return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.initialized||this.init(),t.next=3,this.handleUserMessage(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"handleUserMessage",value:(t=i(d().mark((function t(e){var n,i,a,r,o,s;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.actionMapBuilder&&this.actionExecutor&&this.apiClient){t.next=2;break}throw new Error("SDK not initialized properly");case 2:return n={id:v("user"),role:"user",content:e,timestamp:Date.now()},this.messages.push(n),i={id:v("loading"),role:"assistant",content:"...",timestamp:Date.now()},this.messages.push(i),this.chatWidget&&this.chatWidget.updateMessages(this.messages),t.prev=7,a=this.actionMapBuilder.getActionMap(),this.actionExecutor.updateActionMap(a),r={url:window.location.href,title:document.title,path:window.location.pathname,referrer:document.referrer||window.location.origin,userAgent:navigator.userAgent,screenWidth:window.screen.width,screenHeight:window.screen.height,viewportWidth:window.innerWidth,viewportHeight:window.innerHeight,timestamp:Date.now()},t.next=13,this.apiClient.sendMessage(e,a,r);case 13:return o=t.sent,this.messages=this.messages.filter((function(t){return t.id!==i.id})),o.response&&o.response.message&&this.messages.push(o.response.message),this.chatWidget&&this.chatWidget.updateMessages(this.messages),o.response&&o.response.actions&&o.response.actions.length>0&&(b(this.config.debug||!1,"Executing actions",o.response.actions),this.actionExecutor.executeActions(o.response.actions)),t.abrupt("return",o);case 21:throw t.prev=21,t.t0=t.catch(7),this.messages=this.messages.filter((function(t){return t.id!==i.id})),s={id:v("error"),role:"system",content:"Sorry, there was an error processing your request.",timestamp:Date.now()},this.messages.push(s),this.chatWidget&&this.chatWidget.updateMessages(this.messages),console.error("Error handling user message:",t.t0),t.t0;case 29:case"end":return t.stop()}}),t,this,[[7,21]])}))),function(e){return t.apply(this,arguments)})},{key:"getMessages",value:function(){return this.messages}},{key:"getActionMap",value:function(){return this.actionMapBuilder?this.actionMapBuilder.getActionMap():null}}]);var t,e}();y._instance=null,"undefined"!=typeof document&&document.addEventListener("DOMContentLoaded",(function(){var t=document.querySelector("script[data-api-key]");if(t){var e=t.getAttribute("data-api-key");if(e){var n=t.getAttribute("data-position"),i=t.hasAttribute("data-debug"),a=new y({apiKey:e,debug:i,chatWidget:{enable:!0,position:n||"right"}});a.init(),window.NotificAI=a}}}));var w=y;t.NotificAI=w,t.default=y,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=notific-ai-sdk.umd.js.map
